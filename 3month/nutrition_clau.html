<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infographic Báo cáo Dinh dưỡng 3 Tháng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 350px;
            max-height: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 768px) {
            .chart-container { height: 400px; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-[#0075FF] mb-2">Báo cáo Dinh dưỡng 3 Tháng</h1>
            <p class="text-lg text-slate-600">Phân tích trực quan hành trình dinh dưỡng của bạn.</p>
        </header>

        <div id="report-content">
            <section id="kpis" class="mb-12">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold">Tổng quan Nhanh</h2>
                    <p class="text-slate-500">So sánh chỉ số trung bình của bạn với mục tiêu hàng ngày.</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 text-center">
                        <h3 class="font-semibold text-slate-500">Calo Trung bình/Ngày</h3>
                        <p id="avg-calories" class="text-4xl font-bold text-[#00A2FF] my-2">0</p>
                        <p class="text-sm font-semibold text-red-500" id="calories-diff"></p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 text-center">
                        <h3 class="font-semibold text-slate-500">Tỷ lệ Carbohydrate</h3>
                        <p id="avg-carbs" class="text-4xl font-bold text-[#00C2F2] my-2">0%</p>
                        <p class="text-sm text-slate-500">Mục tiêu: 45%</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 text-center">
                        <h3 class="font-semibold text-slate-500">Tỷ lệ Chất béo</h3>
                        <p id="avg-fat" class="text-4xl font-bold text-[#00E0D2] my-2">0%</p>
                        <p class="text-sm text-slate-500">Mục tiêu: 35%</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200 text-center">
                        <h3 class="font-semibold text-slate-500">Tỷ lệ Protein</h3>
                        <p id="avg-protein" class="text-4xl font-bold text-[#00F0B5] my-2">0%</p>
                        <p class="text-sm text-slate-500">Mục tiêu: 20%</p>
                    </div>
                </div>
            </section>

            <section id="trends" class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200 mb-12">
                <h2 class="text-3xl font-bold text-center mb-2">Xu hướng Năng lượng Hàng ngày</h2>
                <p class="text-center text-slate-500 mb-6 max-w-3xl mx-auto">Biểu đồ này theo dõi lượng calo bạn nạp vào mỗi ngày. Sự dao động là bình thường, nhưng việc nhận biết các đỉnh và đáy có thể giúp bạn hiểu rõ hơn về thói quen ăn uống của mình.</p>
                <div class="chart-container">
                    <canvas id="calories-chart"></canvas>
                </div>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 mb-12">
                <section id="macros" class="lg:col-span-3 bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                    <h2 class="text-3xl font-bold text-center mb-2">Phân bổ Dinh dưỡng Đa lượng</h2>
                    <p class="text-center text-slate-500 mb-6">Bạn đã cân bằng các chất dinh dưỡng đa lượng (Carb, Fat, Protein) tốt như thế nào? Biểu đồ này cho thấy sự phân bổ trung bình của bạn rất gần với tỷ lệ mục tiêu, đây là một thành tích tuyệt vời.</p>
                    <div class="chart-container" style="height: 420px;">
                        <canvas id="macros-chart"></canvas>
                    </div>
                </section>

                <section id="recommendations" class="lg:col-span-2 bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
                    <h2 class="text-3xl font-bold text-center mb-6">Kế hoạch Hành động</h2>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-10 h-10 bg-[#00A2FF] text-white text-xl font-bold rounded-full flex items-center justify-center mr-4">1</div>
                            <div>
                                <h3 class="font-bold text-lg">Kiểm soát khẩu phần</h3>
                                <p class="text-slate-600">Giảm nhẹ khẩu phần ăn hoặc một bữa ăn nhẹ để điều chỉnh lượng calo chênh lệch mỗi ngày.</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-10 h-10 bg-[#00C2F2] text-white text-xl font-bold rounded-full flex items-center justify-center mr-4">2</div>
                            <div>
                                <h3 class="font-bold text-lg">Lựa chọn Thông minh</h3>
                                <p class="text-slate-600">Ưu tiên thực phẩm giàu dinh dưỡng nhưng ít calo như rau xanh, thịt nạc.</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-10 h-10 bg-[#00E0D2] text-white text-xl font-bold rounded-full flex items-center justify-center mr-4">3</div>
                            <div>
                                <h3 class="font-bold text-lg">Duy trì Ổn định</h3>
                                <p class="text-slate-600">Cố gắng giữ lượng calo gần mức mục tiêu 1600 kcal để có nguồn năng lượng ổn định.</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-10 h-10 bg-[#00F0B5] text-white text-xl font-bold rounded-full flex items-center justify-center mr-4">4</div>
                            <div>
                                <h3 class="font-bold text-lg">Bổ sung Chất béo Tốt</h3>
                                <p class="text-slate-600">Bổ sung các nguồn chất béo lành mạnh như bơ, các loại hạt, dầu ô liu để đạt mục tiêu 35%.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <footer class="text-center text-slate-500 text-sm pt-8">
            <p>Báo cáo được tạo tự động dựa trên dữ liệu bạn cung cấp.</p>
        </footer>

    </div>

    <script>
    window.addEventListener('load', function() {
        // Data is now embedded directly in the script to avoid fetch errors.
        const embeddedData = [
            {"DateTime":"23/06/2025","Fat (kcal)":"548.82","Carbs (kcal)":"575.62","Protein (kcal)":"177.87"},
            {"DateTime":"25/06/2025","Fat (kcal)":"343.07","Carbs (kcal)":"708.05","Protein (kcal)":"214.90"},
            {"DateTime":"26/06/2025","Fat (kcal)":"267.60","Carbs (kcal)":"557.69","Protein (kcal)":"182.36"},
            {"DateTime":"27/06/2025","Fat (kcal)":"517.73","Carbs (kcal)":"727.52","Protein (kcal)":"310.06"},
            {"DateTime":"28/06/2025","Fat (kcal)":"493.90","Carbs (kcal)":"702.66","Protein (kcal)":"284.49"},
            {"DateTime":"29/06/2025","Fat (kcal)":"507.69","Carbs (kcal)":"727.44","Protein (kcal)":"291.80"},
            {"DateTime":"30/06/2025","Fat (kcal)":"500.17","Carbs (kcal)":"778.16","Protein (kcal)":"273.85"},
            {"DateTime":"01/07/2025","Fat (kcal)":"450.60","Carbs (kcal)":"828.91","Protein (kcal)":"264.18"},
            {"DateTime":"02/07/2025","Fat (kcal)":"546.78","Carbs (kcal)":"808.16","Protein (kcal)":"292.83"},
            {"DateTime":"03/07/2025","Fat (kcal)":"535.75","Carbs (kcal)":"759.23","Protein (kcal)":"287.47"},
            {"DateTime":"04/07/2025","Fat (kcal)":"680.75","Carbs (kcal)":"773.57","Protein (kcal)":"296.79"},
            {"DateTime":"05/07/2025","Fat (kcal)":"579.59","Carbs (kcal)":"886.85","Protein (kcal)":"302.50"},
            {"DateTime":"06/07/2025","Fat (kcal)":"545.45","Carbs (kcal)":"749.78","Protein (kcal)":"281.39"},
            {"DateTime":"07/07/2025","Fat (kcal)":"570.62","Carbs (kcal)":"803.18","Protein (kcal)":"279.79"},
            {"DateTime":"08/07/2025","Fat (kcal)":"594.39","Carbs (kcal)":"778.96","Protein (kcal)":"290.43"},
            {"DateTime":"09/07/2025","Fat (kcal)":"603.54","Carbs (kcal)":"840.48","Protein (kcal)":"327.94"},
            {"DateTime":"10/07/2025","Fat (kcal)":"561.02","Carbs (kcal)":"803.11","Protein (kcal)":"279.41"},
            {"DateTime":"11/07/2025","Fat (kcal)":"576.27","Carbs (kcal)":"826.54","Protein (kcal)":"286.96"},
            {"DateTime":"12/07/2025","Fat (kcal)":"629.62","Carbs (kcal)":"871.18","Protein (kcal)":"306.40"},
            {"DateTime":"13/07/2025","Fat (kcal)":"567.89","Carbs (kcal)":"788.08","Protein (kcal)":"295.53"},
            {"DateTime":"14/07/2025","Fat (kcal)":"634.33","Carbs (kcal)":"826.98","Protein (kcal)":"311.97"},
            {"DateTime":"15/07/2025","Fat (kcal)":"578.41","Carbs (kcal)":"843.08","Protein (kcal)":"286.29"},
            {"DateTime":"16/07/2025","Fat (kcal)":"582.49","Carbs (kcal)":"793.84","Protein (kcal)":"286.38"},
            {"DateTime":"17/07/2025","Fat (kcal)":"539.86","Carbs (kcal)":"772.58","Protein (kcal)":"270.79"},
            {"DateTime":"18/07/2025","Fat (kcal)":"579.52","Carbs (kcal)":"799.30","Protein (kcal)":"290.72"},
            {"DateTime":"19/07/2025","Fat (kcal)":"576.71","Carbs (kcal)":"782.16","Protein (kcal)":"285.49"},
            {"DateTime":"20/07/2025","Fat (kcal)":"616.68","Carbs (kcal)":"805.51","Protein (kcal)":"310.45"},
            {"DateTime":"21/07/2025","Fat (kcal)":"601.78","Carbs (kcal)":"819.34","Protein (kcal)":"282.72"},
            {"DateTime":"22/07/2025","Fat (kcal)":"558.05","Carbs (kcal)":"835.61","Protein (kcal)":"274.63"},
            {"DateTime":"23/07/2025","Fat (kcal)":"615.15","Carbs (kcal)":"860.03","Protein (kcal)":"301.29"},
            {"DateTime":"24/07/2025","Fat (kcal)":"559.81","Carbs (kcal)":"789.70","Protein (kcal)":"273.66"},
            {"DateTime":"25/07/2025","Fat (kcal)":"581.67","Carbs (kcal)":"877.94","Protein (kcal)":"296.69"},
            {"DateTime":"26/07/2025","Fat (kcal)":"588.19","Carbs (kcal)":"808.97","Protein (kcal)":"308.21"},
            {"DateTime":"27/07/2025","Fat (kcal)":"602.81","Carbs (kcal)":"842.06","Protein (kcal)":"301.99"},
            {"DateTime":"28/07/2025","Fat (kcal)":"566.08","Carbs (kcal)":"797.71","Protein (kcal)":"281.76"},
            {"DateTime":"29/07/2025","Fat (kcal)":"583.56","Carbs (kcal)":"837.98","Protein (kcal)":"311.23"},
            {"DateTime":"30/07/2025","Fat (kcal)":"582.47","Carbs (kcal)":"816.09","Protein (kcal)":"281.01"},
            {"DateTime":"31/07/2025","Fat (kcal)":"553.48","Carbs (kcal)":"804.75","Protein (kcal)":"273.91"},
            {"DateTime":"01/08/2025","Fat (kcal)":"601.12","Carbs (kcal)":"776.43","Protein (kcal)":"302.26"},
            {"DateTime":"02/08/2025","Fat (kcal)":"550.94","Carbs (kcal)":"821.57","Protein (kcal)":"275.29"},
            {"DateTime":"03/08/2025","Fat (kcal)":"559.35","Carbs (kcal)":"826.91","Protein (kcal)":"288.63"},
            {"DateTime":"04/08/2025","Fat (kcal)":"579.80","Carbs (kcal)":"800.28","Protein (kcal)":"292.83"},
            {"DateTime":"05/08/2025","Fat (kcal)":"594.13","Carbs (kcal)":"863.10","Protein (kcal)":"312.20"},
            {"DateTime":"06/08/2025","Fat (kcal)":"577.81","Carbs (kcal)":"929.66","Protein (kcal)":"277.18"},
            {"DateTime":"07/08/2025","Fat (kcal)":"712.59","Carbs (kcal)":"803.84","Protein (kcal)":"324.01"},
            {"DateTime":"08/08/2025","Fat (kcal)":"537.05","Carbs (kcal)":"871.66","Protein (kcal)":"268.84"},
            {"DateTime":"09/08/2025","Fat (kcal)":"627.42","Carbs (kcal)":"808.18","Protein (kcal)":"314.75"},
            {"DateTime":"10/08/2025","Fat (kcal)":"532.85","Carbs (kcal)":"834.82","Protein (kcal)":"276.86"},
            {"DateTime":"11/08/2025","Fat (kcal)":"569.34","Carbs (kcal)":"932.09","Protein (kcal)":"312.59"},
            {"DateTime":"12/08/2025","Fat (kcal)":"549.15","Carbs (kcal)":"781.09","Protein (kcal)":"324.49"},
            {"DateTime":"13/08/2025","Fat (kcal)":"676.27","Carbs (kcal)":"829.33","Protein (kcal)":"291.31"},
            {"DateTime":"14/08/2025","Fat (kcal)":"579.29","Carbs (kcal)":"811.64","Protein (kcal)":"285.87"},
            {"DateTime":"15/08/2025","Fat (kcal)":"654.42","Carbs (kcal)":"926.53","Protein (kcal)":"370.74"},
            {"DateTime":"16/08/2025","Fat (kcal)":"561.82","Carbs (kcal)":"849.29","Protein (kcal)":"273.69"},
            {"DateTime":"17/08/2025","Fat (kcal)":"590.22","Carbs (kcal)":"814.77","Protein (kcal)":"290.79"},
            {"DateTime":"18/08/2025","Fat (kcal)":"567.88","Carbs (kcal)":"816.14","Protein (kcal)":"292.05"},
            {"DateTime":"19/08/2025","Fat (kcal)":"597.55","Carbs (kcal)":"792.83","Protein (kcal)":"313.25"},
            {"DateTime":"20/08/2025","Fat (kcal)":"591.90","Carbs (kcal)":"856.24","Protein (kcal)":"294.02"},
            {"DateTime":"21/08/2025","Fat (kcal)":"642.10","Carbs (kcal)":"847.01","Protein (kcal)":"313.37"}
        ];

        const TARGET_CALORIES = 1600;
        const TARGET_DISTRIBUTION = { Carbs: 45, Fat: 35, Protein: 20 };
        const PALETTE = {
            blue1: '#0075FF', blue2: '#00A2FF', cyan1: '#00C2F2',
            cyan2: '#00E0D2', green: '#00F0B5', red: '#FF4136', slate: '#64748b'
        };
        
        let caloriesChart = null;
        let macrosChart = null;
        
        function processAndVisualize(data) {
            const processedData = data.map(row => {
                const dateStr = row.DateTime;
                if (!dateStr) return null;
                const parts = dateStr.split('/');
                if (parts.length !== 3) return null;

                const date = new Date(parts[2], parts[1] - 1, parts[0]);
                
                const fat_kcal = parseFloat(row['Fat (kcal)']) || 0;
                const carbs_kcal = parseFloat(row['Carbs (kcal)']) || 0;
                const protein_kcal = parseFloat(row['Protein (kcal)']) || 0;
                const total_kcal = fat_kcal + carbs_kcal + protein_kcal;
                
                return { date, fat_kcal, carbs_kcal, protein_kcal, total_kcal };
            }).filter(d => d && !isNaN(d.date.getTime()) && d.total_kcal > 0)
              .sort((a, b) => a.date - b.date);
            
            if (processedData.length === 0) {
                 throw new Error('Không có dữ liệu hợp lệ nào được tìm thấy.');
            }

            const totalDays = processedData.length;
            const totalSum = processedData.reduce((acc, curr) => {
                acc.total_kcal += curr.total_kcal;
                acc.fat_kcal += curr.fat_kcal;
                acc.carbs_kcal += curr.carbs_kcal;
                acc.protein_kcal += curr.protein_kcal;
                return acc;
            }, { total_kcal: 0, fat_kcal: 0, carbs_kcal: 0, protein_kcal: 0 });

            const avg_total_kcal = totalSum.total_kcal / totalDays;
            const avg_fat_kcal = totalSum.fat_kcal / totalDays;
            const avg_carbs_kcal = totalSum.carbs_kcal / totalDays;
            const avg_protein_kcal = totalSum.protein_kcal / totalDays;

            const avg_macros_distribution = {
                Fat: (avg_fat_kcal / avg_total_kcal) * 100,
                Carbs: (avg_carbs_kcal / avg_total_kcal) * 100,
                Protein: (avg_protein_kcal / avg_total_kcal) * 100
            };
            
            updateDOM(avg_total_kcal, avg_macros_distribution);
            createCaloriesChart(processedData);
            createMacrosChart(avg_macros_distribution);
        }
        
        function updateDOM(avgCalories, avgMacros) {
            document.getElementById('avg-calories').textContent = avgCalories.toFixed(0);
            const diff = avgCalories - TARGET_CALORIES;
            const diffText = diff > 0 ? `+${diff.toFixed(0)}` : diff.toFixed(0);
            document.getElementById('calories-diff').textContent = `${diffText} kcal vs. Mục tiêu ${TARGET_CALORIES}`;
            document.getElementById('calories-diff').className = `text-sm font-semibold ${diff > 0 ? 'text-red-500' : 'text-green-500'}`;

            document.getElementById('avg-carbs').textContent = `${avgMacros.Carbs.toFixed(1)}%`;
            document.getElementById('avg-fat').textContent = `${avgMacros.Fat.toFixed(1)}%`;
            document.getElementById('avg-protein').textContent = `${avgMacros.Protein.toFixed(1)}%`;
        }
        
        function createCaloriesChart(data) {
            const ctx = document.getElementById('calories-chart').getContext('2d');
            if (caloriesChart) {
                caloriesChart.destroy();
            }
            caloriesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date.toLocaleDateString('vi-VN', { month: 'short', day: 'numeric' })),
                    datasets: [{
                        label: 'Calo Thực tế',
                        data: data.map(d => d.total_kcal),
                        borderColor: PALETTE.blue2,
                        backgroundColor: 'rgba(0, 162, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 1,
                        pointHoverRadius: 5
                    }, {
                        label: 'Mục tiêu Calo',
                        data: Array(data.length).fill(TARGET_CALORIES),
                        borderColor: PALETTE.red,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false, title: { display: true, text: 'Kcal' } } },
                    plugins: { tooltip: { callbacks: { title: (items) => items[0].label } } }
                }
            });
        }
        
        function createMacrosChart(avgMacros) {
            const ctx = document.getElementById('macros-chart').getContext('2d');
            if (macrosChart) {
                macrosChart.destroy();
            }
            macrosChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Carbohydrate', 'Chất béo', 'Protein'],
                    datasets: [{
                        label: 'Thực tế',
                        data: [avgMacros.Carbs, avgMacros.Fat, avgMacros.Protein],
                        backgroundColor: [PALETTE.cyan1, PALETTE.cyan2, PALETTE.green],
                        borderRadius: 6
                    }, {
                        label: 'Mục tiêu',
                        data: [TARGET_DISTRIBUTION.Carbs, TARGET_DISTRIBUTION.Fat, TARGET_DISTRIBUTION.Protein],
                        backgroundColor: 'rgba(100, 116, 139, 0.2)',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { title: { display: true, text: 'Tỷ lệ (%)' } } },
                    plugins: { 
                        tooltip: { 
                            callbacks: { 
                                title: (items) => items[0].label,
                                label: (context) => `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`
                            }
                        },
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        try {
            processAndVisualize(embeddedData);
        } catch(e) {
            console.error("Lỗi khi xử lý dữ liệu được nhúng:", e);
            const reportDiv = document.getElementById('report-content');
            reportDiv.innerHTML = `<div class="text-center text-red-500 bg-white p-8 rounded-xl shadow-lg border border-red-200">
                <h2 class="text-2xl font-bold mb-4">Đã xảy ra lỗi</h2>
                <p>Không thể xử lý dữ liệu được nhúng. Vui lòng kiểm tra console để biết thêm chi tiết.</p>
            </div>`;
        }
    });
    </script>
</body>
</html>

