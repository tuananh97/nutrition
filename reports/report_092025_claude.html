<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Ph√¢n T√≠ch Dinh D∆∞·ª°ng</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .patient-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .info-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .info-card p {
            font-size: 24px;
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .status-good {
            color: #10b981;
            font-weight: bold;
        }

        .status-warning {
            color: #f59e0b;
            font-weight: bold;
        }

        .status-danger {
            color: #ef4444;
            font-weight: bold;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric-box {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metric-box h4 {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 5px;
        }

        .metric-box p {
            font-size: 18px;
            font-weight: bold;
            color: #1e293b;
        }

        .metric-box .target {
            font-size: 12px;
            color: #64748b;
            margin-top: 3px;
        }

        .recommendation {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .recommendation h4 {
            color: #92400e;
            margin-bottom: 8px;
        }

        .recommendation ul {
            margin-left: 20px;
            color: #78350f;
        }

        .recommendation li {
            margin: 5px 0;
        }

        .assessment {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .assessment h4 {
            color: #1e40af;
            margin-bottom: 8px;
        }

        .assessment p {
            color: #1e3a8a;
            line-height: 1.6;
        }

        .warning-box {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .warning-box h4 {
            color: #991b1b;
            margin-bottom: 8px;
        }

        .warning-box ul {
            margin-left: 20px;
            color: #7f1d1d;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f1f5f9;
            color: #475569;
            font-weight: 600;
        }

        tr:hover {
            background: #f8fafc;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Dashboard Ph√¢n T√≠ch Dinh D∆∞·ª°ng</h1>
            <p style="color: #64748b; margin-top: 5px;">B·ªánh nh√¢n nam, 28 tu·ªïi - Dinh d∆∞·ª°ng qua PEG & ƒë∆∞·ªùng mi·ªáng</p>
            
            <div class="patient-info">
                <div class="info-card">
                    <h3>C√¢n n·∫∑ng</h3>
                    <p>45 kg</p>
                </div>
                <div class="info-card">
                    <h3>Chi·ªÅu cao</h3>
                    <p>165 cm</p>
                </div>
                <div class="info-card">
                    <h3>BMI</h3>
                    <p>16.5</p>
                </div>
                <div class="info-card">
                    <h3>M·ª•c ti√™u Energy</h3>
                    <p>1700 kcal</p>
                </div>
                <div class="info-card">
                    <h3>S·ªë b·ªØa/ng√†y</h3>
                    <p>6 b·ªØa</p>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card full-width">
                <h2>1. ƒê√°nh Gi√° T·ªïng H·ª£p T√¨nh Tr·∫°ng Dinh D∆∞·ª°ng</h2>
                
                <div class="assessment">
                    <h4>üìè ƒê√°nh gi√° c√¢n n·∫∑ng</h4>
                    <p><strong>C√¢n n·∫∑ng hi·ªán t·∫°i:</strong> 45 kg</p>
                    <p><strong>C√¢n n·∫∑ng l√Ω t∆∞·ªüng (IBW):</strong> ~59-64 kg (c√¥ng th·ª©c Devine nam: 50 + 2.3 √ó (65-60) = ~61.5 kg)</p>
                    <p><strong>% C√¢n n·∫∑ng l√Ω t∆∞·ªüng:</strong> 45/61.5 √ó 100 = <span class="status-danger">73.2%</span></p>
                    <p><strong>BMI:</strong> 45/(1.65¬≤) = <span class="status-danger">16.5</span> (Thi·∫øu c√¢n ƒë·ªô II)</p>
                </div>

                <div class="warning-box">
                    <h4>‚ö†Ô∏è M·ª©c ƒë·ªô suy dinh d∆∞·ª°ng</h4>
                    <p><strong>Ch·∫©n ƒëo√°n:</strong> Suy dinh d∆∞·ª°ng trung b√¨nh ƒë·∫øn n·∫∑ng</p>
                    <ul>
                        <li>BMI < 18.5 (thi·∫øu c√¢n)</li>
                        <li>Thi·∫øu 26.8% so v·ªõi c√¢n n·∫∑ng l√Ω t∆∞·ªüng</li>
                        <li>Nguy c∆° cao suy ki·ªát c∆° v√† c√°c bi·∫øn ch·ª©ng</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <h4>üö® Nguy c∆° ng·∫Øn h·∫°n</h4>
                    <ul>
                        <li><strong>M·ªát m·ªèi:</strong> Thi·∫øu nƒÉng l∆∞·ª£ng cho ho·∫°t ƒë·ªông h√†ng ng√†y</li>
                        <li><strong>T√°o b√≥n:</strong> L∆∞·ª£ng x∆° ch∆∞a ƒë·∫°t m·ª•c ti√™u (TB: 24.6g, m·ª•c ti√™u: 25g)</li>
                        <li><strong>Gi·∫£m mi·ªÖn d·ªãch:</strong> Thi·∫øu protein v√† vi ch·∫•t</li>
                        <li><strong>Ch·∫≠m l√†nh v·∫øt th∆∞∆°ng:</strong> Do thi·∫øu protein, zinc, vitamin C</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <h4>‚è∞ Nguy c∆° d√†i h·∫°n</h4>
                    <ul>
                        <li><strong>Lo√£ng x∆∞∆°ng:</strong> Calcium trung b√¨nh (1262mg/ng√†y) ƒë·∫°t, nh∆∞ng Vitamin D th·∫•p (TB: 505 IU, c·∫ßn 600-800 IU) - c·∫ßn b·ªï sung</li>
                        <li><strong>Thi·∫øu m√°u:</strong> S·∫Øt ƒë·∫°t trung b√¨nh 16.2mg/ng√†y (t·ªët), nh∆∞ng c·∫ßn theo d√µi B12, folate</li>
                        <li><strong>S·ª•t c√¢n ti·∫øp t·ª•c:</strong> NƒÉng l∆∞·ª£ng trung b√¨nh 1804 kcal/ng√†y ch·ªâ ƒë·ªß duy tr√¨, ch∆∞a ƒë·ªß ƒë·ªÉ tƒÉng c√¢n</li>
                        <li><strong>Suy gi·∫£m c∆°:</strong> Protein trung b√¨nh 84.5g/ng√†y t·ªët, nh∆∞ng c·∫ßn v·∫≠n ƒë·ªông nh·∫π k·∫øt h·ª£p</li>
                    </ul>
                </div>
            </div>

            <div class="card full-width">
                <h2>2. Ph√¢n T√≠ch T·ª∑ L·ªá C√°c Nh√≥m Dinh D∆∞·ª°ng</h2>
                <div class="metric-grid">
                    <div class="metric-box">
                        <h4>Trung b√¨nh Energy</h4>
                        <p class="status-good">1804 kcal</p>
                        <p class="target">M·ª•c ti√™u: 1700 kcal ‚úì</p>
                    </div>
                    <div class="metric-box">
                        <h4>Trung b√¨nh Protein</h4>
                        <p class="status-good">84.5 g</p>
                        <p class="target">M·ª•c ti√™u: 75g ‚úì</p>
                    </div>
                    <div class="metric-box">
                        <h4>Trung b√¨nh Fat</h4>
                        <p class="status-good">75.8 g</p>
                        <p class="target">M·ª•c ti√™u: 65g (cao 16%)</p>
                    </div>
                    <div class="metric-box">
                        <h4>Trung b√¨nh Carbs</h4>
                        <p class="status-good">209.4 g</p>
                        <p class="target">M·ª•c ti√™u: 190g (cao 10%)</p>
                    </div>
                    <div class="metric-box">
                        <h4>Trung b√¨nh Fiber</h4>
                        <p class="status-warning">24.6 g</p>
                        <p class="target">M·ª•c ti√™u: 25g (g·∫ßn ƒë·∫°t)</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="macroChart"></canvas>
                </div>
                
                <div class="assessment" style="margin-top: 20px;">
                    <h4>üìä Ph√¢n t√≠ch t·ª∑ l·ªá nƒÉng l∆∞·ª£ng</h4>
                    <p><strong>T·ª∑ l·ªá hi·ªán t·∫°i:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Carbohydrate: 46.4% (209.4g √ó 4 kcal / 1804 kcal)</li>
                        <li>Fat: 37.8% (75.8g √ó 9 kcal / 1804 kcal)</li>
                        <li>Protein: 18.7% (84.5g √ó 4 kcal / 1804 kcal)</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>T·ª∑ l·ªá m·ª•c ti√™u:</strong> 45% carbs / 35% fat / 20% protein</p>
                    <p style="margin-top: 10px;"><strong>Nh·∫≠n x√©t:</strong> <span class="status-good">T·ª∑ l·ªá dinh d∆∞·ª°ng kh√° c√¢n ƒë·ªëi!</span> Ch·∫•t b√©o h∆°i cao 2.8%, protein h∆°i th·∫•p 1.3%. C·∫ßn ƒëi·ªÅu ch·ªânh nh·∫π ƒë·ªÉ ƒë·∫°t t·ª∑ l·ªá t·ªëi ∆∞u.</p>
                </div>
            </div>

            <div class="card">
                <h2>3. Bi·∫øn ƒê·ªông NƒÉng L∆∞·ª£ng Theo Ng√†y</h2>
                <div class="chart-container">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>4. Theo D√µi Protein, Fat, Carbs</h2>
                <div class="chart-container">
                    <canvas id="macroTrendChart"></canvas>
                </div>
            </div>

            <div class="card full-width">
                <h2>5. Ph√¢n T√≠ch Vitamin & Kho√°ng Ch·∫•t</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Vi ch·∫•t</th>
                            <th>Trung b√¨nh/ng√†y</th>
                            <th>Khuy·∫øn ngh·ªã</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody id="micronutrientTable"></tbody>
                </table>
            </div>

            <div class="card">
                <h2>6. Ph√¢n T√≠ch Ch·∫•t B√©o</h2>
                <div class="chart-container">
                    <canvas id="fatChart"></canvas>
                </div>
                <div class="assessment" style="margin-top: 20px;">
                    <h4>ü•ë ƒê√°nh gi√° ch·∫•t b√©o</h4>
                    <p><strong>Ch·∫•t b√©o ƒë∆°n kh√¥ng b√£o h√≤a:</strong> TB 30.2g/ng√†y (t·ªët cho tim m·∫°ch)</p>
                    <p><strong>Omega-3:</strong> TB 3.2g/ng√†y (r·∫•t t·ªët, > 1.6g khuy·∫øn ngh·ªã)</p>
                    <p><strong>Omega-6:</strong> TB 11.4g/ng√†y (c·∫ßn c√¢n b·∫±ng v·ªõi Omega-3)</p>
                    <p><strong>T·ª∑ l·ªá Omega-6/Omega-3:</strong> ~3.6:1 (kh√° t·ªët, l√Ω t∆∞·ªüng 4:1)</p>
                </div>
            </div>

            <div class="card">
                <h2>7. Ph√¢n T√≠ch Carbohydrate</h2>
                <div class="chart-container">
                    <canvas id="carbChart"></canvas>
                </div>
                <div class="assessment" style="margin-top: 20px;">
                    <h4>üåæ ƒê√°nh gi√° carbohydrate</h4>
                    <p><strong>Tinh b·ªôt (ph·ª©c h·ª£p):</strong> TB 57.3g/ng√†y</p>
                    <p><strong>ƒê∆∞·ªùng (ƒë∆°n):</strong> TB 58.4g/ng√†y</p>
                    <p><strong>T·ª∑ l·ªá:</strong> G·∫ßn c√¢n b·∫±ng 49% ph·ª©c / 51% ƒë∆°n</p>
                    <p><strong>Khuy·∫øn ngh·ªã:</strong> <span class="status-warning">C·∫ßn tƒÉng tinh b·ªôt, gi·∫£m ƒë∆∞·ªùng ƒë∆°n</span> ƒë·ªÉ ·ªïn ƒë·ªãnh ƒë∆∞·ªùng huy·∫øt.</p>
                </div>
            </div>

            <div class="card full-width">
                <h2>8. Khuy·∫øn Ngh·ªã C·∫£i Thi·ªán Dinh D∆∞·ª°ng</h2>
                
                <div class="recommendation">
                    <h4>üéØ ƒêi·ªÅu ch·ªânh nƒÉng l∆∞·ª£ng ƒë·ªÉ tƒÉng c√¢n</h4>
                    <ul>
                        <li><strong>TƒÉng th√™m 300-500 kcal/ng√†y</strong> ƒë·ªÉ ƒë·∫°t 2000-2200 kcal (m·ª•c ti√™u tƒÉng 0.5kg/tu·∫ßn)</li>
                        <li>Th√™m 1 b·ªØa s·ªØa 230 kcal v√†o bu·ªïi t·ªëi (t·ªïng 3 b·ªØa s·ªØa)</li>
                        <li>TƒÉng l∆∞·ª£ng s√∫p xay: th√™m 2 th√¨a d·∫ßu olive (180 kcal) ho·∫∑c b∆° v√†o s√∫p</li>
                        <li>Th√™m 1 ly sinh t·ªë cao nƒÉng l∆∞·ª£ng (chu·ªëi, b∆°, s·ªØa, m·∫≠t ong) ~250 kcal</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h4>ü•© T·ªëi ∆∞u Protein (tƒÉng t·ª´ 84.5g l√™n 90-100g)</h4>
                    <ul>
                        <li>Th√™m b·ªôt protein v√†o s√∫p (10-15g/b·ªØa): whey, casein, ho·∫∑c protein th·ª±c v·∫≠t</li>
                        <li>S·ª≠ d·ª•ng s·ªØa cao protein (Ensure, Glucerna) thay v√¨ s·ªØa th∆∞·ªùng</li>
                        <li>Th√™m tr·ª©ng v√†o s√∫p xay (1-2 qu·∫£/ng√†y)</li>
                        <li>S√∫p xay t·ª´ th·ªãt g√†, c√°, ƒë·∫≠u h≈© m·ªÅm</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h4>ü•ë ƒêi·ªÅu ch·ªânh Lipid (gi·∫£m t·ª´ 75.8g xu·ªëng 70g, ch·ªçn lo·∫°i t·ªët)</h4>
                    <ul>
                        <li>∆Øu ti√™n d·∫ßu olive, d·∫ßu h·∫°t lanh (gi√†u Omega-3)</li>
                        <li>B∆° xay nhuy·ªÖn trong sinh t·ªë</li>
                        <li>Tr√°nh d·∫ßu c√¥ng nghi·ªáp, m·ª° b√£o h√≤a</li>
                        <li>Duy tr√¨ Omega-3 cao: c√° h·ªìi, c√° thu xay nhuy·ªÖn</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h4>üåæ C√¢n b·∫±ng Carbohydrate (gi·∫£m ƒë∆∞·ªùng ƒë∆°n, tƒÉng ph·ª©c h·ª£p)</h4>
                    <ul>
                        <li>TƒÉng tinh b·ªôt: ch√°o y·∫øn m·∫°ch, khoai lang xay, c∆°m nghi·ªÅn</li>
                        <li>Gi·∫£m ƒë∆∞·ªùng trong n∆∞·ªõc tr√°i c√¢y: pha lo√£ng h∆°n ho·∫∑c thay b·∫±ng n∆∞·ªõc l·ªçc + chanh</li>
                        <li>D√πng m·∫≠t ong thay ƒë∆∞·ªùng tinh luy·ªán (trong sinh t·ªë)</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h4>ü•¨ B·ªï sung Ch·∫•t x∆° (tƒÉng t·ª´ 24.6g l√™n 28-30g)</h4>
                    <ul>
                        <li>Rau xanh xay nhuy·ªÖn: b√≠ ng√¥, b√¥ng c·∫£i, rau bina</li>
                        <li>H·∫°t chia, h·∫°t lanh xay m·ªãn (1-2 th√¨a/ng√†y)</li>
                        <li>Y·∫øn m·∫°ch xay nhuy·ªÖn trong s√∫p ho·∫∑c sinh t·ªë</li>
                        <li>Tr√°i c√¢y m·ªÅm: chu·ªëi ch√≠n, ƒëu ƒë·ªß, b∆°</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h4>üíä B·ªï sung Vi ch·∫•t thi·∫øu h·ª•t</h4>
                    <ul>
                        <li><strong>Vitamin D:</strong> Hi·ªán 505 IU/ng√†y (thi·∫øu). C·∫ßn b·ªï sung 1000-2000 IU qua vi√™n u·ªëng ho·∫∑c s·ªØa tƒÉng c∆∞·ªùng</li>
                        <li><strong>Vitamin E:</strong> Hi·ªán 18mg (ƒë·ªß), duy tr√¨ qua d·∫ßu th·ª±c v·∫≠t, h·∫°t</li>
                        <li><strong>Vitamin K:</strong> Bi·∫øn ƒë·ªông l·ªõn (93-1207 ¬µg). ·ªîn ƒë·ªãnh ngu·ªìn rau xanh</li>
                        <li><strong>K·∫Ωm (Zinc):</strong> 13.3mg/ng√†y (t·ªët), duy tr√¨ qua th·ªãt, h·∫£i s·∫£n</li>
                        <li><strong>Magie:</strong> 451mg/ng√†y (t·ªët), duy tr√¨ qua h·∫°t, ng≈© c·ªëc</li>
                        <li><strong>Selen:</strong> 88 ¬µg/ng√†y (ƒë·ªß), duy tr√¨ qua c√°, tr·ª©ng</li>
                    </ul>
                </div>

                <div class="recommendation">
                    <h4>üçΩÔ∏è G·ª£i √Ω ph√¢n chia 6 b·ªØa/ng√†y (t·ªïng ~2100 kcal)</h4>
                    <ul>
                        <li><strong>6h - S√°ng s·ªõm:</strong> S·ªØa cao nƒÉng l∆∞·ª£ng 230ml (230 kcal)</li>
                        <li><strong>8h - B·ªØa ch√≠nh 1:</strong> S√∫p xay dinh d∆∞·ª°ng (th·ªãt/c√°, rau, khoai, d·∫ßu olive) 400ml (~450 kcal)</li>
                        <li><strong>11h - Ph·ª•:</strong> Sinh t·ªë (chu·ªëi, b∆°, s·ªØa, y·∫øn m·∫°ch, m·∫≠t ong) 250ml (~300 kcal)</li>
                        <li><strong>14h - B·ªØa ch√≠nh 2:</strong> S√∫p xay ƒëa d·∫°ng 400ml (~450 kcal)</li>
                        <li><strong>17h - Ph·ª•:</strong> S·ªØa cao nƒÉng l∆∞·ª£ng 230ml (230 kcal)</li>
                        <li><strong>20h - B·ªØa ch√≠nh 3:</strong> S√∫p xay + n∆∞·ªõc tr√°i c√¢y lo√£ng 400ml (~350 kcal)</li>
                        <li><strong>22h - Tr∆∞·ªõc ng·ªß:</strong> S·ªØa ·∫•m 200ml (180 kcal)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const csvData = `DateTime,Energy (kcal),Carbs (g),Fiber (g),Starch (g),Sugars (g),Fat (g),Monounsaturated (g),Omega-3 (g),Omega-6 (g),Protein (g),Vitamin A (¬µg),Vitamin C (mg),Vitamin D (IU),Vitamin E (mg),Vitamin K (¬µg),Calcium (mg),Copper (mg),Iron (mg),Magnesium (mg),Manganese (mg),Phosphorus (mg),Potassium (mg),Selenium (¬µg),Sodium (mg),Zinc (mg)
01/09/2025,1639.2,193.6,17.7,60,45.8,67.2,30.5,3.3,9.7,73,1391,215.8,591,20,123.7,1148.6,1.7,15.8,313,3.8,1265.5,3097.2,65.6,1237.2,13.9
02/09/2025,1539.3,188.7,14.6,55,46.9,57.5,25.6,2.3,8.6,74.1,1079.1,204.9,544.5,18,314.9,1135,1.3,16.4,355.2,4.2,1238.2,3041.8,104.2,1362,13.9
03/09/2025,1730,201.3,18.6,45.4,57.9,66.4,23.6,3.9,15.9,89.5,1344.2,194.9,546,17.5,367.8,1160.1,1.6,16.6,377.3,4.3,1271.5,2919,85.2,1411.2,12.7
04/09/2025,1657.1,208.5,23.2,58.3,57.5,66.7,29.4,2.2,9.8,64.6,1011.7,153.6,587.2,20.3,111.3,1216.1,1.4,13.3,291.1,3.6,1030.5,2881.1,66.1,1847.9,11
05/09/2025,1697.4,204.5,19.1,59,56.3,72.7,26.9,4.1,16.5,65.7,1006.1,141.1,587.2,18.3,93.5,1224,1.4,13.5,303.8,4.2,1072.3,2715.5,66.7,1846,11.3
06/09/2025,1714.4,205.8,18.6,52.7,57.8,61.3,26.3,2.1,9.4,89.9,1348.9,217.6,546,20.1,378,1148.9,1.6,17.6,375.4,4.2,1273.7,3072.3,88.3,1423.4,12.7
07/09/2025,1767,198.9,22.2,52.9,56.2,78.5,31.6,4.1,17.4,77.4,1326.5,236.3,544.5,19.4,111.1,1200.8,1.8,15,386.7,4.7,1306.5,3689.7,104.4,1574.9,14.3
08/09/2025,1836.3,214.3,23.2,69.6,50.1,80.2,36,2.3,14,74.1,1037.3,219.3,587.2,22.7,118.6,1269.9,1.6,15.1,407.3,4.9,1234.8,3531.2,78.5,1985.5,12.4
09/09/2025,1792.2,233.7,27.2,63.6,70.5,66.7,30.4,2.3,10.4,76.6,1328.9,240.2,544.5,19.8,119.8,1163.2,1.6,15.1,349.1,4.5,1302.6,3452.2,106.8,1386.4,14.2
10/09/2025,1970.5,211.3,20.5,47.6,66.4,84.2,33.2,4.2,18.3,98.8,1296.2,241.6,594.7,20.3,123.5,1196.8,1.9,18.5,361,4.6,1430.6,3304.3,104.3,1507.3,13.7
11/09/2025,1874.9,233.6,24.7,63.9,78,76.9,29.2,4.3,16.3,83.5,1271.8,225.4,546.9,20.9,504.8,1341.4,2.4,18.4,520.4,5.3,1526.9,3785.2,111.4,1530.2,15.7
12/09/2025,1802.1,204.2,18.3,56.1,56.6,67.1,28.1,2.6,9.9,99.7,1583.9,159.7,596,19.6,527.2,1277.1,1.5,18.3,419.6,4.5,1444.4,3241.6,113.5,1661.1,13.7
13/09/2025,1860,225.3,30.9,60.8,63,77.7,33.3,5.3,10.4,81.7,1567.7,147.1,604.1,20.4,387.1,1363.3,2.1,18.5,491.8,4.9,1562,3756.2,82.5,1488.8,15
14/09/2025,1717.6,216.4,20.2,56.8,72.1,64.8,26.7,3.8,10.2,77,1411.2,254.7,547,18.2,100.6,1284.7,1.4,15.3,370.9,4.3,1339.3,3544,111.3,1607.7,14
15/09/2025,1895.5,203.2,31.3,59,56,80.3,31.1,2.4,10.5,105.2,1494.4,112.6,460.8,15.9,518.1,1309,2.3,17.7,547,4.8,1685.3,4209,103.2,1801.1,13.2
16/09/2025,1793.3,201.9,31.6,56.6,54.8,78.9,26.7,3.4,8.3,86.7,1886.4,187.2,410.3,14.1,487.2,1318.3,1.9,16.7,533.7,4.4,1524.9,4305.5,99.7,1737.7,13.6
17/09/2025,1907.1,230.1,36.7,59,65.2,74.2,28.6,2.3,9.9,98.6,1494.7,203.1,411.4,16.5,522.5,1244.9,2.3,17.5,522.4,4.7,1567.4,4086.4,82.6,1565,12.9
18/09/2025,1759.9,187.3,21.2,49.5,42.5,79.5,32,3.7,9.9,83.4,1179.9,142.1,546.1,20,516.5,1290.1,1.6,19.3,421.8,4.1,1362.1,3563,111.4,1521.6,14.8
19/09/2025,1797.6,230.6,36,62.9,63,70.8,27.7,2.2,8.9,80.2,1167.2,151.5,407.5,15.4,523.7,1240.4,2.4,19.7,514.9,4.9,1528.7,4292.8,68.1,1473.8,17.6
20/09/2025,1765.1,198,25.5,63.5,49.5,78.3,32.6,2.2,10.2,82.4,1265.9,238.6,407.4,16.4,529.3,1212.3,2,15.1,494.1,3.8,1528.8,4155.6,80.4,1472.6,13
21/09/2025,1916.6,221.7,31.7,63.6,64.3,85.6,30.5,4.1,17.3,84.4,1210,185.7,410.3,17.9,507.5,1249.5,2,14.2,473.8,4.3,1505.6,4200.5,94.4,1481.5,13.4
22/09/2025,1847.3,206.9,28.8,49.8,61.3,85.1,35.7,3.3,10.3,81,1326.4,177,468.3,15.8,376.7,1251.8,2.2,15.9,459.5,3.5,1513.1,3677.2,59,1458.7,12.7
23/09/2025,1994.4,220.7,26.4,68.5,63.2,85.7,36.9,2.4,12.1,96,1237.7,226.1,411.4,18.2,540.4,1155.4,2.1,13.8,461.4,3.4,1553,3893.9,76.4,1431.1,12.5
24/09/2025,1851.4,217.1,26.9,61,66.3,79.9,32.7,3.3,10.5,81,926.5,160.5,410.5,17.1,248.9,1290.8,2.2,16.6,418.9,3.8,1528.5,3807.7,96.9,1311.6,13.2
25/09/2025,1856.4,216.5,31.5,51.3,59.2,81.6,34.1,3.2,9.8,80.6,1152.2,226.4,448,15.9,252.9,1173.2,2.2,16.4,389.8,3.7,1452.8,3487.2,58.6,1306,12.1
26/09/2025,1877.4,203.6,28.5,62.4,52,80.7,32.2,3.4,10.9,96,1324,165.9,412,16.7,311.7,1395.9,2.1,15.7,450.8,4.1,1609.1,3973.9,81.6,1478.6,12.8
27/09/2025,1779.2,198.6,26.7,62.3,51.9,79.9,32.5,3.5,10.6,82.3,1214.2,199.7,395.1,16.3,505.3,1251.8,2,14.8,513.2,3.8,1503.5,4082,97.3,1614.2,13.3
28/09/2025,1801.3,188.9,27.3,50.3,49.9,79.2,31.9,3.5,10.9,95.6,1184.4,209.6,396.6,15.8,1207.1,1279,2.1,16.7,478.6,4.2,1515.1,3810,79.9,1378.7,12.7
29/09/2025,1791.4,195.2,25.8,63.4,47.9,82.4,29.9,3.9,15.4,83.3,1472.9,211.7,410.5,19.2,885.9,1290.8,1.9,14.8,520.2,4.2,1511.1,4195.6,91.6,1537.2,13.1
30/09/2025,1825.3,189.9,26,50.3,51.7,80.8,32.1,3.5,10.8,96.8,1135.5,183.4,412,15.5,409.2,1264.5,2.1,16.1,478.5,3.8,1545.7,3621.5,80.6,1418.4,12.4`;

        Papa.parse(csvData, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: function(results) {
                const data = results.data;
                analyzeData(data);
            }
        });

        function analyzeData(data) {
            // Calculate averages
            const avg = {};
            const fields = Object.keys(data[0]).filter(k => k !== 'DateTime');
            
            fields.forEach(field => {
                const values = data.map(d => d[field]).filter(v => v !== null && v !== undefined);
                avg[field] = values.reduce((a, b) => a + b, 0) / values.length;
            });

            // Macro ratio chart
            const macroCtx = document.getElementById('macroChart').getContext('2d');
            new Chart(macroCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Carbohydrate (46.4%)', 'Fat (37.8%)', 'Protein (18.7%)'],
                    datasets: [{
                        data: [46.4, 37.8, 18.7],
                        backgroundColor: ['#f59e0b', '#ef4444', '#3b82f6'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                padding: 15
                            }
                        },
                        title: {
                            display: true,
                            text: 'T·ª∑ l·ªá nƒÉng l∆∞·ª£ng hi·ªán t·∫°i vs M·ª•c ti√™u (45% / 35% / 20%)',
                            font: { size: 14, weight: 'bold' }
                        }
                    }
                }
            });

            // Energy trend chart
            const energyCtx = document.getElementById('energyChart').getContext('2d');
            new Chart(energyCtx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.DateTime),
                    datasets: [{
                        label: 'NƒÉng l∆∞·ª£ng (kcal)',
                        data: data.map(d => d['Energy (kcal)']),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'M·ª•c ti√™u 1700 kcal',
                        data: Array(data.length).fill(1700),
                        borderColor: '#10b981',
                        borderDash: [5, 5],
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 1400,
                            max: 2100
                        }
                    }
                }
            });

            // Macro trends chart
            const macroTrendCtx = document.getElementById('macroTrendChart').getContext('2d');
            new Chart(macroTrendCtx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.DateTime),
                    datasets: [{
                        label: 'Protein (g)',
                        data: data.map(d => d['Protein (g)']),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: false
                    }, {
                        label: 'Fat (g)',
                        data: data.map(d => d['Fat (g)']),
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: false
                    }, {
                        label: 'Carbs (g)',
                        data: data.map(d => d['Carbs (g)']),
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Fat composition chart
            const fatCtx = document.getElementById('fatChart').getContext('2d');
            new Chart(fatCtx, {
                type: 'bar',
                data: {
                    labels: ['Ch·∫•t b√©o ƒë∆°n', 'Omega-3', 'Omega-6'],
                    datasets: [{
                        label: 'Trung b√¨nh (g/ng√†y)',
                        data: [avg['Monounsaturated (g)'], avg['Omega-3 (g)'], avg['Omega-6 (g)']],
                        backgroundColor: ['#8b5cf6', '#10b981', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Carb composition chart
            const carbCtx = document.getElementById('carbChart').getContext('2d');
            new Chart(carbCtx, {
                type: 'bar',
                data: {
                    labels: ['Tinh b·ªôt', 'ƒê∆∞·ªùng', 'X∆°'],
                    datasets: [{
                        label: 'Trung b√¨nh (g/ng√†y)',
                        data: [avg['Starch (g)'], avg['Sugars (g)'], avg['Fiber (g)']],
                        backgroundColor: ['#f59e0b', '#ef4444', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Micronutrient table
            const micronutrients = [
                { name: 'Vitamin A', field: 'Vitamin A (¬µg)', rda: '900 ¬µg', unit: '¬µg' },
                { name: 'Vitamin C', field: 'Vitamin C (mg)', rda: '90 mg', unit: 'mg' },
                { name: 'Vitamin D', field: 'Vitamin D (IU)', rda: '600-800 IU', unit: 'IU' },
                { name: 'Vitamin E', field: 'Vitamin E (mg)', rda: '15 mg', unit: 'mg' },
                { name: 'Vitamin K', field: 'Vitamin K (¬µg)', rda: '120 ¬µg', unit: '¬µg' },
                { name: 'Calcium', field: 'Calcium (mg)', rda: '1000 mg', unit: 'mg' },
                { name: 'Iron', field: 'Iron (mg)', rda: '8 mg', unit: 'mg' },
                { name: 'Magnesium', field: 'Magnesium (mg)', rda: '400 mg', unit: 'mg' },
                { name: 'Phosphorus', field: 'Phosphorus (mg)', rda: '700 mg', unit: 'mg' },
                { name: 'Potassium', field: 'Potassium (mg)', rda: '3400 mg', unit: 'mg' },
                { name: 'Zinc', field: 'Zinc (mg)', rda: '11 mg', unit: 'mg' },
                { name: 'Selenium', field: 'Selenium (¬µg)', rda: '55 ¬µg', unit: '¬µg' },
                { name: 'Copper', field: 'Copper (mg)', rda: '0.9 mg', unit: 'mg' },
                { name: 'Manganese', field: 'Manganese (mg)', rda: '2.3 mg', unit: 'mg' }
            ];

            const tableBody = document.getElementById('micronutrientTable');
            micronutrients.forEach(nutrient => {
                const avgValue = avg[nutrient.field];
                const row = document.createElement('tr');
                
                let status = '';
                let statusClass = '';
                
                // Determine status based on RDA
                const rdaValue = parseFloat(nutrient.rda);
                if (nutrient.name === 'Vitamin D') {
                    status = avgValue < 600 ? '‚ö†Ô∏è Thi·∫øu' : '‚úì ƒê·ªß';
                    statusClass = avgValue < 600 ? 'status-warning' : 'status-good';
                } else if (nutrient.name === 'Potassium') {
                    status = avgValue < 3400 ? '‚ö†Ô∏è Thi·∫øu nh·∫π' : '‚úì ƒê·ªß';
                    statusClass = avgValue < 3400 ? 'status-warning' : 'status-good';
                } else if (avgValue >= rdaValue * 0.9) {
                    status = '‚úì ƒê·ªß';
                    statusClass = 'status-good';
                } else if (avgValue >= rdaValue * 0.7) {
                    status = '‚ö†Ô∏è G·∫ßn ƒë·ªß';
                    statusClass = 'status-warning';
                } else {
                    status = '‚ùå Thi·∫øu';
                    statusClass = 'status-danger';
                }
                
                row.innerHTML = `
                    <td><strong>${nutrient.name}</strong></td>
                    <td>${avgValue.toFixed(1)} ${nutrient.unit}</td>
                    <td>${nutrient.rda}</td>
                    <td class="${statusClass}">${status}</td>
                `;
                tableBody.appendChild(row);
            });
        }
    </script>
</body>
</html>