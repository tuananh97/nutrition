<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Phân tích Dinh dưỡng Tháng 9</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .patient-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .patient-info div {
            margin-right: 20px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1.3rem;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 15px 0;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.05);
        }
        
        .summary-card h3 {
            font-size: 0.9rem;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .summary-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .summary-card .target {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        .positive {
            color: var(--success);
        }
        
        .negative {
            color: var(--danger);
        }
        
        .neutral {
            color: var(--warning);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        table, th, td {
            border: 1px solid #ddd;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .recommendations {
            background-color: #e8f4f8;
            border-left: 4px solid var(--secondary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-good {
            background-color: var(--success);
        }
        
        .status-warning {
            background-color: var(--warning);
        }
        
        .status-poor {
            background-color: var(--danger);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .patient-info {
                flex-direction: column;
            }
            
            .patient-info div {
                margin-bottom: 10px;
            }
        }
        
        .tab-container {
            margin: 20px 0;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dashboard Phân tích Dinh dưỡng Tháng 9</h1>
            <div class="patient-info">
                <div><strong>Bệnh nhân:</strong> Nam, 28 tuổi</div>
                <div><strong>Cân nặng:</strong> 45kg</div>
                <div><strong>Chiều cao:</strong> 165cm</div>
                <div><strong>BMI:</strong> 16.5 (Thiếu cân)</div>
                <div><strong>Phương thức:</strong> Ăn qua sonde dạ dày PEG + uống đồ lỏng</div>
            </div>
        </header>

        <div class="summary-cards">
            <div class="summary-card">
                <h3>Tổng năng lượng</h3>
                <div class="value">1,783 kcal</div>
                <div class="target">Mục tiêu: 1,700 kcal</div>
                <div class="positive">+4.9%</div>
            </div>
            <div class="summary-card">
                <h3>Chất béo</h3>
                <div class="value">75.6g</div>
                <div class="target">Mục tiêu: 65g</div>
                <div class="negative">+16.3%</div>
            </div>
            <div class="summary-card">
                <h3>Carbohydrate</h3>
                <div class="value">208.8g</div>
                <div class="target">Mục tiêu: 190g</div>
                <div class="negative">+9.9%</div>
            </div>
            <div class="summary-card">
                <h3>Protein</h3>
                <div class="value">85.3g</div>
                <div class="target">Mục tiêu: 75g</div>
                <div class="positive">+13.7%</div>
            </div>
            <div class="summary-card">
                <h3>Chất xơ</h3>
                <div class="value">25.9g</div>
                <div class="target">Mục tiêu: 25g</div>
                <div class="positive">+3.6%</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h2>Đánh giá Tình trạng Dinh dưỡng</h2>
                <p><span class="status-indicator status-poor"></span> <strong>BMI:</strong> 16.5 - Thiếu cân độ I</p>
                <p><span class="status-indicator status-warning"></span> <strong>Cân nặng lý tưởng:</strong> 56-68kg (thiếu 11-23kg)</p>
                <p><span class="status-indicator status-warning"></span> <strong>Nguy cơ ngắn hạn:</strong> Mệt mỏi, giảm miễn dịch</p>
                <p><span class="status-indicator status-poor"></span> <strong>Nguy cơ dài hạn:</strong> Loãng xương, thiếu máu, sụt cân thêm</p>
                <div class="recommendations">
                    <p><strong>Khuyến nghị:</strong> Cần tăng năng lượng và protein để cải thiện cân nặng và tình trạng dinh dưỡng.</p>
                </div>
            </div>

            <div class="card">
                <h2>Tỷ lệ Dinh dưỡng So Với Mục Tiêu</h2>
                <div class="chart-container">
                    <canvas id="ratioComparisonChart"></canvas>
                </div>
                <p>Chất béo và carbohydrate vượt mục tiêu, trong khi protein đạt tốt. Cần điều chỉnh tỷ lệ.</p>
            </div>

            <div class="card">
                <h2>Xu hướng Năng lượng Hàng ngày</h2>
                <div class="chart-container">
                    <canvas id="energyTrendChart"></canvas>
                </div>
                <p>Năng lượng dao động từ 1,539 đến 1,994 kcal, nhìn chung ổn định và trên mục tiêu.</p>
            </div>

            <div class="card">
                <h2>Phân tích Vi chất Quan trọng</h2>
                <div class="chart-container">
                    <canvas id="micronutrientChart"></canvas>
                </div>
                <p>Hầu hết vi chất đạt hoặc vượt nhu cầu, ngoại trừ Vitamin D cần bổ sung thêm.</p>
            </div>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" data-tab="nutrition">Phân tích Dinh dưỡng</div>
                <div class="tab" data-tab="days">Ngày Mạnh/Yếu</div>
                <div class="tab" data-tab="recommendations">Khuyến nghị</div>
            </div>
            
            <div class="tab-content active" id="nutrition-tab">
                <div class="card">
                    <h2>Phân tích Chi tiết Các Nhóm Dinh dưỡng</h2>
                    <div class="chart-container">
                        <canvas id="macronutrientTrendChart"></canvas>
                    </div>
                    
                    <h3>Chất béo</h3>
                    <p>Lượng chất béo trung bình: 75.6g (vượt 16.3% so với mục tiêu). Tỷ lệ chất béo không bão hòa đơn (Monounsaturated) chiếm ~40% tổng chất béo, là tỷ lệ tốt.</p>
                    
                    <h3>Carbohydrate</h3>
                    <p>Lượng carbohydrate trung bình: 208.8g (vượt 9.9% so với mục tiêu). Tỷ lệ đường (Sugars) chiếm ~30% tổng carbohydrate, cần giảm bớt.</p>
                    
                    <h3>Protein</h3>
                    <p>Lượng protein trung bình: 85.3g (vượt 13.7% so với mục tiêu). Đây là điểm tích cực cho việc phục hồi cân nặng.</p>
                    
                    <h3>Chất xơ</h3>
                    <p>Lượng chất xơ trung bình: 25.9g (đạt mục tiêu). Giúp ngăn ngừa táo bón, đặc biệt quan trọng với chế độ ăn lỏng.</p>
                </div>
            </div>
            
            <div class="tab-content" id="days-tab">
                <div class="card">
                    <h2>Phân tích Các Ngày Mạnh/Yếu</h2>
                    <table>
                        <tr>
                            <th>Chỉ số</th>
                            <th>Cao nhất</th>
                            <th>Thấp nhất</th>
                        </tr>
                        <tr>
                            <td>Năng lượng</td>
                            <td>23/09 (1994.4 kcal)</td>
                            <td>02/09 (1539.3 kcal)</td>
                        </tr>
                        <tr>
                            <td>Protein</td>
                            <td>15/09 (105.2g)</td>
                            <td>04/09 (64.6g)</td>
                        </tr>
                        <tr>
                            <td>Carbohydrate</td>
                            <td>09/09 (233.7g)</td>
                            <td>18/09 (187.3g)</td>
                        </tr>
                        <tr>
                            <td>Chất béo</td>
                            <td>10/09 (84.2g)</td>
                            <td>02/09 (57.5g)</td>
                        </tr>
                        <tr>
                            <td>Chất xơ</td>
                            <td>17/09 (36.7g)</td>
                            <td>02/09 (14.6g)</td>
                        </tr>
                    </table>
                    <p><strong>Nhận xét:</strong> Có sự dao động đáng kể giữa các ngày, đặc biệt là protein và chất xơ. Cần ổn định hơn trong chế độ ăn.</p>
                </div>
            </div>
            
            <div class="tab-content" id="recommendations-tab">
                <div class="card">
                    <h2>Khuyến nghị Dinh dưỡng Chi tiết</h2>
                    
                    <h3>Mục tiêu Tăng cân</h3>
                    <p>Để tăng 0.5kg/tuần, cần bổ sung thêm 500 kcal/ngày so với hiện tại (tổng ~2,300 kcal/ngày).</p>
                    
                    <h3>Điều chỉnh các Nhóm Dinh dưỡng</h3>
                    <ul>
                        <li><strong>Protein:</strong> Duy trì ở mức 85-90g/ngày. Bổ sung bột protein vào sinh tố và sữa.</li>
                        <li><strong>Chất béo:</strong> Giảm nhẹ xuống 70g/ngày. Ưu tiên chất béo không bão hòa (dầu ô liu, dầu cá).</li>
                        <li><strong>Carbohydrate:</strong> Giảm đường đơn, tăng tinh bột phức hợp trong súp xay.</li>
                    </ul>
                    
                    <h3>Bổ sung Vi chất</h3>
                    <ul>
                        <li><strong>Vitamin D:</strong> Bổ sung 400-800 IU/ngày (hiện đạt ~70% nhu cầu).</li>
                        <li><strong>Kẽm:</strong> Tiếp tục chế độ hiện tại (đạt 90% nhu cầu).</li>
                        <li><strong>Sắt:</strong> Duy trì chế độ hiện tại (đạt trên 100% nhu cầu).</li>
                    </ul>
                    
                    <h3>Tối ưu Chế độ Ăn</h3>
                    <p>Phân chia 6 bữa/ngày hợp lý:</p>
                    <ul>
                        <li>3 bữa súp xay (tăng độ đặc và năng lượng)</li>
                        <li>2 bữa sữa 230kcal (có thể tăng lên 250-300kcal)</li>
                        <li>1 ly nước trái cây 200ml (giảm đường, tăng rau củ)</li>
                        <li>1 ly sinh tố (bổ sung bột protein, hạt chia)</li>
                    </ul>
                    
                    <div class="recommendations">
                        <p><strong>Lưu ý quan trọng:</strong> Theo dõi cân nặng hàng tuần và điều chỉnh năng lượng phù hợp. Tăng dần độ đặc của thức ăn lỏng khi bệnh nhân dung nạp tốt.</p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Báo cáo được tạo dựa trên dữ liệu dinh dưỡng tháng 9/2025 | Phòng khám Dinh dưỡng</p>
        </footer>
    </div>

    <script>
        // Dữ liệu từ CSV
        const dates = [
            '01/09', '02/09', '03/09', '04/09', '05/09', '06/09', '07/09', '08/09', '09/09', '10/09',
            '11/09', '12/09', '13/09', '14/09', '15/09', '16/09', '17/09', '18/09', '19/09', '20/09',
            '21/09', '22/09', '23/09', '24/09', '25/09', '26/09', '27/09', '28/09', '29/09', '30/09'
        ];
        
        const energyData = [
            1639.2, 1539.3, 1730, 1657.1, 1697.4, 1714.4, 1767, 1836.3, 1792.2, 1970.5,
            1874.9, 1802.1, 1860, 1717.6, 1895.5, 1793.3, 1907.1, 1759.9, 1797.6, 1765.1,
            1916.6, 1847.3, 1994.4, 1851.4, 1856.4, 1877.4, 1779.2, 1801.3, 1791.4, 1825.3
        ];
        
        const carbsData = [
            193.6, 188.7, 201.3, 208.5, 204.5, 205.8, 198.9, 214.3, 233.7, 211.3,
            233.6, 204.2, 225.3, 216.4, 203.2, 201.9, 230.1, 187.3, 230.6, 198,
            221.7, 206.9, 220.7, 217.1, 216.5, 203.6, 198.6, 188.9, 195.2, 189.9
        ];
        
        const fiberData = [
            17.7, 14.6, 18.6, 23.2, 19.1, 18.6, 22.2, 23.2, 27.2, 20.5,
            24.7, 18.3, 30.9, 20.2, 31.3, 31.6, 36.7, 21.2, 36, 25.5,
            31.7, 28.8, 26.4, 26.9, 31.5, 28.5, 26.7, 27.3, 25.8, 26
        ];
        
        const fatData = [
            67.2, 57.5, 66.4, 66.7, 72.7, 61.3, 78.5, 80.2, 66.7, 84.2,
            76.9, 67.1, 77.7, 64.8, 80.3, 78.9, 74.2, 79.5, 70.8, 78.3,
            85.6, 85.1, 85.7, 79.9, 81.6, 80.7, 79.9, 79.2, 82.4, 80.8
        ];
        
        const proteinData = [
            73, 74.1, 89.5, 64.6, 65.7, 89.9, 77.4, 74.1, 76.6, 98.8,
            83.5, 99.7, 81.7, 77, 105.2, 86.7, 98.6, 83.4, 80.2, 82.4,
            84.4, 81, 96, 81, 80.6, 96, 82.3, 95.6, 83.3, 96.8
        ];

        // Tính giá trị trung bình
        const avgEnergy = (energyData.reduce((a, b) => a + b, 0) / energyData.length).toFixed(1);
        const avgCarbs = (carbsData.reduce((a, b) => a + b, 0) / carbsData.length).toFixed(1);
        const avgFat = (fatData.reduce((a, b) => a + b, 0) / fatData.length).toFixed(1);
        const avgProtein = (proteinData.reduce((a, b) => a + b, 0) / proteinData.length).toFixed(1);
        const avgFiber = (fiberData.reduce((a, b) => a + b, 0) / fiberData.length).toFixed(1);

        // Tính tỷ lệ phần trăm từ gram
        const energyFromCarbs = avgCarbs * 4;
        const energyFromFat = avgFat * 9;
        const energyFromProtein = avgProtein * 4;
        const totalEnergy = energyFromCarbs + energyFromFat + energyFromProtein;
        
        const carbsPercentage = (energyFromCarbs / totalEnergy * 100).toFixed(1);
        const fatPercentage = (energyFromFat / totalEnergy * 100).toFixed(1);
        const proteinPercentage = (energyFromProtein / totalEnergy * 100).toFixed(1);

        // Vẽ biểu đồ so sánh tỷ lệ dinh dưỡng
        const ratioComparisonCtx = document.getElementById('ratioComparisonChart').getContext('2d');
        new Chart(ratioComparisonCtx, {
            type: 'bar',
            data: {
                labels: ['Carbohydrate', 'Chất béo', 'Protein'],
                datasets: [
                    {
                        label: 'Mục tiêu (%)',
                        data: [45, 35, 20],
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Thực tế (%)',
                        data: [carbsPercentage, fatPercentage, proteinPercentage],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 50,
                        title: {
                            display: true,
                            text: 'Tỷ lệ (%)'
                        }
                    }
                }
            }
        });

        // Vẽ biểu đồ xu hướng năng lượng
        const energyTrendCtx = document.getElementById('energyTrendChart').getContext('2d');
        new Chart(energyTrendCtx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'Năng lượng (kcal)',
                        data: energyData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Mục tiêu (1700 kcal)',
                        data: Array(dates.length).fill(1700),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Kcal'
                        }
                    }
                }
            }
        });

        // Vẽ biểu đồ vi chất
        const micronutrientCtx = document.getElementById('micronutrientChart').getContext('2d');
        new Chart(micronutrientCtx, {
            type: 'radar',
            data: {
                labels: ['Vitamin A', 'Vitamin C', 'Vitamin D', 'Vitamin E', 'Canxi', 'Sắt', 'Kẽm'],
                datasets: [
                    {
                        label: 'Thực tế (% nhu cầu)',
                        data: [120, 180, 70, 110, 125, 200, 90],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                    },
                    {
                        label: 'Mục tiêu (100%)',
                        data: [100, 100, 100, 100, 100, 100, 100],
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 200
                    }
                }
            }
        });

        // Vẽ biểu đồ xu hướng đa lượng
        const macronutrientTrendCtx = document.getElementById('macronutrientTrendChart').getContext('2d');
        new Chart(macronutrientTrendCtx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'Carbohydrate (g)',
                        data: carbsData,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        fill: false,
                        tension: 0.3
                    },
                    {
                        label: 'Chất béo (g)',
                        data: fatData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        fill: false,
                        tension: 0.3
                    },
                    {
                        label: 'Protein (g)',
                        data: proteinData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        fill: false,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            text: 'Gram (g)'
                        }
                    }
                }
            }
        });

        // Xử lý tab
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Xóa active từ tất cả các tab và nội dung
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Thêm active cho tab được click
                tab.classList.add('active');
                
                // Hiển thị nội dung tương ứng
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
    </script>
</body>
</html>