<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo cáo Dinh dưỡng - Bệnh nhân 28 tuổi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .patient-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            flex: 1;
            min-width: 200px;
        }
        
        .info-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .info-card p {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .card h2 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .summary-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .summary-card.good {
            border-left: 4px solid var(--secondary);
        }
        
        .summary-card.warning {
            border-left: 4px solid var(--warning);
        }
        
        .summary-card.danger {
            border-left: 4px solid var(--danger);
        }
        
        .recommendations {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-top: 30px;
        }
        
        .recommendations h2 {
            color: var(--dark);
            margin-bottom: 20px;
        }
        
        .recommendation-item {
            margin-bottom: 15px;
            padding-left: 20px;
            border-left: 3px solid var(--primary);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .status-good {
            color: var(--secondary);
            font-weight: bold;
        }
        
        .status-warning {
            color: var(--warning);
            font-weight: bold;
        }
        
        .status-danger {
            color: var(--danger);
            font-weight: bold;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--dark);
            margin: 30px 0 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Báo cáo Dinh dưỡng Chi tiết</h1>
            <p>Bệnh nhân: Nam, 28 tuổi, 45kg, 165cm</p>
            <p>Phương thức dinh dưỡng: Ăn qua sonde dạ dày PEG + uống đồ lỏng</p>
        </header>
        
        <div class="patient-info">
            <div class="info-card">
                <h3>Cân nặng lý tưởng</h3>
                <p>59.4 kg</p>
            </div>
            <div class="info-card">
                <h3>Chỉ số BMI</h3>
                <p>16.5 <span class="status-danger">(Thiếu cân nặng)</span></p>
            </div>
            <div class="info-card">
                <h3>Năng lượng trung bình</h3>
                <p>1,853 kcal/ngày</p>
            </div>
            <div class="info-card">
                <h3>Protein trung bình</h3>
                <p>88.5 g/ngày</p>
            </div>
        </div>
        
        <h2 class="section-title">1. Đánh giá Tình trạng Dinh dưỡng</h2>
        <div class="summary-section">
            <div class="summary-card danger">
                <h3>Tình trạng suy dinh dưỡng</h3>
                <p>Mức độ nặng (BMI = 16.5)</p>
                <p>Thiếu 14.4kg so với cân nặng lý tưởng</p>
            </div>
            <div class="summary-card warning">
                <h3>Nguy cơ ngắn hạn</h3>
                <p>Mệt mỏi, táo bón, giảm miễn dịch</p>
            </div>
            <div class="summary-card warning">
                <h3>Nguy cơ dài hạn</h3>
                <p>Loãng xương, thiếu máu, sụt cân thêm</p>
            </div>
        </div>
        
        <h2 class="section-title">2. Phân tích Tỷ lệ Dinh dưỡng</h2>
        <div class="dashboard-grid">
            <div class="card">
                <h2>Tỷ lệ Dinh dưỡng Đa lượng</h2>
                <div class="chart-container">
                    <canvas id="macronutrientRatioChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>So sánh với Mục tiêu</h2>
                <div class="chart-container">
                    <canvas id="goalComparisonChart"></canvas>
                </div>
            </div>
        </div>
        
        <h2 class="section-title">3. Phân tích Các Ngày Mạnh/Yếu</h2>
        <div class="card">
            <h2>Biến động Năng lượng Hàng ngày</h2>
            <div class="chart-container">
                <canvas id="dailyEnergyChart"></canvas>
            </div>
        </div>
        
        <h2 class="section-title">4. Phân tích Vi chất & Khoáng chất</h2>
        <div class="dashboard-grid">
            <div class="card">
                <h2>Vitamin Quan trọng</h2>
                <div class="chart-container">
                    <canvas id="vitaminChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>Khoáng chất Quan trọng</h2>
                <div class="chart-container">
                    <canvas id="mineralChart"></canvas>
                </div>
            </div>
        </div>
        
        <h2 class="section-title">5. Phân tích Theo Thời Gian</h2>
        <div class="card">
            <h2>Xu hướng Dinh dưỡng Theo Tuần</h2>
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
        
        <h2 class="section-title">6. Mối quan hệ Giữa Các Nhóm Dinh dưỡng</h2>
        <div class="card">
            <h2>Tương quan Giữa Chất béo và Carbohydrate</h2>
            <div class="chart-container">
                <canvas id="correlationChart"></canvas>
            </div>
        </div>
        
        <div class="recommendations">
            <h2>7. Khuyến nghị Dinh dưỡng</h2>
            
            <div class="recommendation-item">
                <h3>Điều chỉnh Năng lượng</h3>
                <p>Hiện đang vượt 153 kcal so với mục tiêu. Giảm nhẹ khoảng 150 kcal/ngày bằng cách:</p>
                <ul>
                    <li>Giảm 1/2 ly nước trái cây (khoảng 50 kcal)</li>
                    <li>Giảm 1/4 phần sữa (khoảng 57.5 kcal)</li>
                    <li>Điều chỉnh lượng súp xay (khoảng 45.5 kcal)</li>
                </ul>
            </div>
            
            <div class="recommendation-item">
                <h3>Điều chỉnh Protein</h3>
                <p>Protein hiện vượt mục tiêu (88.5g so với 75g). Cân nhắc giảm nhẹ nguồn đạm trong súp xay.</p>
            </div>
            
            <div class="recommendation-item">
                <h3>Cải thiện Chất xơ</h3>
                <p>Chất xơ trung bình đạt 29.6g/ngày, tốt hơn mục tiêu 25g. Duy trì bằng cách:</p>
                <ul>
                    <li>Tiếp tục bổ sung rau củ xay nhuyễn vào súp</li>
                    <li>Thêm hạt lanh/xay nhỏ vào sinh tố</li>
                    <li>Sử dụng ngũ cốc nguyên cám mịn</li>
                </ul>
            </div>
            
            <div class="recommendation-item">
                <h3>Bổ sung Vi chất</h3>
                <p>Dựa trên phân tích, cần chú ý bổ sung:</p>
                <ul>
                    <li>Vitamin D: Mức trung bình 415.6 IU, cần tăng lên 600-800 IU/ngày</li>
                    <li>Kẽm: Mức trung bình 12.9 mg, đạt mục tiêu nhưng cần duy trì</li>
                    <li>Vitamin B-complex: Không có trong dữ liệu, cần bổ sung thông qua thực phẩm bổ sung</li>
                </ul>
            </div>
            
            <div class="recommendation-item">
                <h3>Tối ưu Hóa Chế độ Ăn</h3>
                <p>Để tăng cân lành mạnh:</p>
                <ul>
                    <li>Duy trì 6 bữa/ngày với phân bổ năng lượng hợp lý</li>
                    <li>Tăng dần kcal mỗi bữa khi dung nạp tốt</li>
                    <li>Ưu tiên thực phẩm giàu năng lượng, dễ tiêu hóa</li>
                    <li>Theo dõi cân nặng hàng tuần để điều chỉnh kịp thời</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Dữ liệu từ CSV
        const nutritionData = [
            {date: '01/10/2025', energy: 1849.6, carbs: 209.1, fiber: 29.7, fat: 76.4, protein: 94.9, vitA: 1088.5, vitC: 241.2, vitD: 412.0, vitE: 16.1, calcium: 1324.1, iron: 16.4, magnesium: 403.0, zinc: 12.1},
            {date: '02/10/2025', energy: 1742.9, carbs: 200.7, fiber: 26.5, fat: 78.1, protein: 71.7, vitA: 978.2, vitC: 119.4, vitD: 453.2, vitE: 15.1, calcium: 1294.6, iron: 12.4, magnesium: 378.8, zinc: 10.2},
            {date: '03/10/2025', energy: 1855.8, carbs: 206.7, fiber: 24.0, fat: 82.1, protein: 82.5, vitA: 923.7, vitC: 142.4, vitD: 410.5, vitE: 16.0, calcium: 1277.2, iron: 15.4, magnesium: 403.6, zinc: 12.8},
            {date: '04/10/2025', energy: 1980.3, carbs: 222.7, fiber: 32.6, fat: 84.9, protein: 96.7, vitA: 1325.9, vitC: 172.3, vitD: 412.0, vitE: 17.1, calcium: 1407.3, iron: 16.1, magnesium: 487.3, zinc: 13.5},
            {date: '05/10/2025', energy: 1819.4, carbs: 189.3, fiber: 27.3, fat: 87.4, protein: 81.7, vitA: 1154.4, vitC: 136.3, vitD: 464.0, vitE: 15.3, calcium: 1351.2, iron: 15.1, magnesium: 422.2, zinc: 13.2},
            {date: '06/10/2025', energy: 1896.0, carbs: 201.1, fiber: 28.6, fat: 84.3, protein: 95.9, vitA: 945.7, vitC: 157.7, vitD: 412.0, vitE: 15.1, calcium: 1321.3, iron: 16.2, magnesium: 465.8, zinc: 13.3},
            {date: '07/10/2025', energy: 1860.5, carbs: 213.5, fiber: 27.1, fat: 82.1, protein: 82.9, vitA: 1561.5, vitC: 187.0, vitD: 410.5, vitE: 17.3, calcium: 1281.0, iron: 15.5, magnesium: 430.4, zinc: 14.0},
            {date: '08/10/2025', energy: 1856.8, carbs: 198.5, fiber: 28.3, fat: 82.4, protein: 94.7, vitA: 835.7, vitC: 156.1, vitD: 384.5, vitE: 14.7, calcium: 1107.4, iron: 16.3, magnesium: 429.0, zinc: 12.6},
            {date: '09/10/2025', energy: 1906.1, carbs: 227.3, fiber: 32.6, fat: 82.7, protein: 82.7, vitA: 1522.0, vitC: 223.3, vitD: 383.0, vitE: 16.2, calcium: 1152.5, iron: 17.1, magnesium: 450.3, zinc: 13.8},
            {date: '10/10/2025', energy: 1894.7, carbs: 216.1, fiber: 30.2, fat: 86.3, protein: 81.6, vitA: 1291.5, vitC: 226.0, vitD: 436.5, vitE: 15.2, calcium: 1153.1, iron: 17.5, magnesium: 457.1, zinc: 13.3},
            {date: '11/10/2025', energy: 2005.0, carbs: 205.5, fiber: 27.0, fat: 92.7, protein: 100.8, vitA: 1010.3, vitC: 227.6, vitD: 422.2, vitE: 16.6, calcium: 1324.0, iron: 16.6, magnesium: 487.2, zinc: 14.0},
            {date: '12/10/2025', energy: 1964.2, carbs: 218.5, fiber: 25.9, fat: 90.7, protein: 85.5, vitA: 1355.4, vitC: 259.5, vitD: 420.7, vitE: 16.9, calcium: 1299.8, iron: 14.1, magnesium: 436.4, zinc: 14.5},
            {date: '13/10/2025', energy: 1904.6, carbs: 198.6, fiber: 29.3, fat: 87.1, protein: 95.2, vitA: 1401.6, vitC: 242.5, vitD: 405.6, vitE: 17.2, calcium: 1246.9, iron: 15.1, magnesium: 426.5, zinc: 13.5},
            {date: '14/10/2025', energy: 1799.7, carbs: 194.6, fiber: 26.7, fat: 84.3, protein: 84.1, vitA: 1245.5, vitC: 212.1, vitD: 401.0, vitE: 16.8, calcium: 1138.3, iron: 14.2, magnesium: 452.6, zinc: 14.0},
            {date: '15/10/2025', energy: 1853.6, carbs: 191.1, fiber: 25.9, fat: 84.4, protein: 96.9, vitA: 1288.9, vitC: 188.6, vitD: 402.5, vitE: 15.8, calcium: 1122.0, iron: 14.0, magnesium: 455.9, zinc: 12.8},
            {date: '16/10/2025', energy: 1854.0, carbs: 203.9, fiber: 29.3, fat: 84.7, protein: 87.0, vitA: 969.7, vitC: 212.4, vitD: 401.0, vitE: 16.0, calcium: 1202.7, iron: 17.2, magnesium: 463.0, zinc: 14.6},
            {date: '17/10/2025', energy: 1867.1, carbs: 192.0, fiber: 26.4, fat: 85.0, protein: 98.2, vitA: 1289.2, vitC: 188.8, vitD: 402.5, vitE: 15.8, calcium: 1126.2, iron: 14.1, magnesium: 462.7, zinc: 13.0},
            {date: '18/10/2025', energy: 1776.4, carbs: 215.7, fiber: 28.9, fat: 71.7, protein: 83.5, vitA: 830.9, vitC: 124.3, vitD: 401.0, vitE: 13.6, calcium: 1145.3, iron: 16.3, magnesium: 418.7, zinc: 13.3},
            {date: '19/10/2025', energy: 1779.7, carbs: 213.4, fiber: 31.5, fat: 71.8, protein: 82.2, vitA: 2060.9, vitC: 247.7, vitD: 396.5, vitE: 17.2, calcium: 1199.0, iron: 14.5, magnesium: 422.5, zinc: 10.4},
            {date: '20/10/2025', energy: 1834.9, carbs: 190.1, fiber: 29.1, fat: 92.5, protein: 76.7, vitA: 959.2, vitC: 239.2, vitD: 447.5, vitE: 17.8, calcium: 1235.4, iron: 16.5, magnesium: 426.8, zinc: 11.8},
            {date: '21/10/2025', energy: 1898.7, carbs: 208.9, fiber: 33.9, fat: 81.7, protein: 97.7, vitA: 1277.7, vitC: 239.1, vitD: 402.5, vitE: 17.2, calcium: 1152.2, iron: 13.8, magnesium: 425.6, zinc: 12.0},
            {date: '22/10/2025', energy: 1894.0, carbs: 205.0, fiber: 30.4, fat: 89.0, protein: 82.6, vitA: 986.4, vitC: 241.8, vitD: 448.7, vitE: 16.9, calcium: 1286.5, iron: 16.1, magnesium: 388.9, zinc: 12.2},
            {date: '23/10/2025', energy: 1892.6, carbs: 211.1, fiber: 35.7, fat: 92.5, protein: 75.5, vitA: 864.9, vitC: 138.3, vitD: 395.0, vitE: 18.3, calcium: 1215.2, iron: 13.2, magnesium: 467.0, zinc: 11.4},
            {date: '24/10/2025', energy: 1919.2, carbs: 205.6, fiber: 31.5, fat: 87.0, protein: 94.6, vitA: 1313.4, vitC: 215.3, vitD: 403.1, vitE: 14.8, calcium: 1178.1, iron: 14.6, magnesium: 413.2, zinc: 11.8},
            {date: '25/10/2025', energy: 1768.6, carbs: 182.3, fiber: 28.7, fat: 86.0, protein: 82.9, vitA: 1084.3, vitC: 171.8, vitD: 447.5, vitE: 16.3, calcium: 1228.3, iron: 17.0, magnesium: 502.4, zinc: 12.8},
            {date: '26/10/2025', energy: 1849.6, carbs: 202.2, fiber: 33.3, fat: 86.2, protein: 86.7, vitA: 1093.6, vitC: 250.0, vitD: 401.0, vitE: 17.6, calcium: 1171.6, iron: 15.8, magnesium: 473.0, zinc: 13.6},
            {date: '27/10/2025', energy: 1895.8, carbs: 198.9, fiber: 31.7, fat: 89.1, protein: 93.6, vitA: 1444.9, vitC: 183.1, vitD: 465.0, vitE: 15.8, calcium: 1224.3, iron: 17.6, magnesium: 487.4, zinc: 13.9},
            {date: '28/10/2025', energy: 1872.9, carbs: 206.7, fiber: 32.9, fat: 86.0, protein: 87.8, vitA: 895.8, vitC: 225.1, vitD: 401.0, vitE: 16.2, calcium: 1135.7, iron: 16.0, magnesium: 425.9, zinc: 14.0},
            {date: '29/10/2025', energy: 1868.6, carbs: 193.1, fiber: 32.4, fat: 89.4, protein: 91.9, vitA: 965.8, vitC: 141.8, vitD: 465.0, vitE: 15.4, calcium: 1274.8, iron: 17.9, magnesium: 459.7, zinc: 13.7},
            {date: '30/10/2025', energy: 1840.2, carbs: 199.6, fiber: 33.3, fat: 82.3, protein: 90.8, vitA: 1705.8, vitC: 127.8, vitD: 396.7, vitE: 14.3, calcium: 1140.5, iron: 12.8, magnesium: 429.3, zinc: 11.7},
            {date: '31/10/2025', energy: 1842.4, carbs: 195.8, fiber: 31.6, fat: 84.9, protein: 93.7, vitA: 956.6, vitC: 235.1, vitD: 402.2, vitE: 15.1, calcium: 1161.3, iron: 16.8, magnesium: 425.7, zinc: 14.4}
        ];

        // Tính toán giá trị trung bình
        const averages = {
            energy: nutritionData.reduce((sum, day) => sum + day.energy, 0) / nutritionData.length,
            carbs: nutritionData.reduce((sum, day) => sum + day.carbs, 0) / nutritionData.length,
            fiber: nutritionData.reduce((sum, day) => sum + day.fiber, 0) / nutritionData.length,
            fat: nutritionData.reduce((sum, day) => sum + day.fat, 0) / nutritionData.length,
            protein: nutritionData.reduce((sum, day) => sum + day.protein, 0) / nutritionData.length,
            vitA: nutritionData.reduce((sum, day) => sum + day.vitA, 0) / nutritionData.length,
            vitC: nutritionData.reduce((sum, day) => sum + day.vitC, 0) / nutritionData.length,
            vitD: nutritionData.reduce((sum, day) => sum + day.vitD, 0) / nutritionData.length,
            vitE: nutritionData.reduce((sum, day) => sum + day.vitE, 0) / nutritionData.length,
            calcium: nutritionData.reduce((sum, day) => sum + day.calcium, 0) / nutritionData.length,
            iron: nutritionData.reduce((sum, day) => sum + day.iron, 0) / nutritionData.length,
            magnesium: nutritionData.reduce((sum, day) => sum + day.magnesium, 0) / nutritionData.length,
            zinc: nutritionData.reduce((sum, day) => sum + day.zinc, 0) / nutritionData.length
        };

        // Tính tỷ lệ dinh dưỡng từ giá trị trung bình
        const avgCarbsKcal = averages.carbs * 4;
        const avgProteinKcal = averages.protein * 4;
        const avgFatKcal = averages.fat * 9;
        const totalAvgKcal = avgCarbsKcal + avgProteinKcal + avgFatKcal;
        
        const actualRatios = {
            carbs: (avgCarbsKcal / totalAvgKcal) * 100,
            protein: (avgProteinKcal / totalAvgKcal) * 100,
            fat: (avgFatKcal / totalAvgKcal) * 100
        };

        // Mục tiêu
        const goals = {
            energy: 1700,
            carbs: 190,
            protein: 75,
            fat: 65,
            fiber: 25,
            ratios: {
                carbs: 45,
                protein: 20,
                fat: 35
            }
        };

        // Biểu đồ 1: Tỷ lệ dinh dưỡng đa lượng
        const macronutrientRatioCtx = document.getElementById('macronutrientRatioChart').getContext('2d');
        new Chart(macronutrientRatioCtx, {
            type: 'doughnut',
            data: {
                labels: ['Carbohydrate', 'Protein', 'Chất béo'],
                datasets: [
                    {
                        label: 'Thực tế',
                        data: [actualRatios.carbs, actualRatios.protein, actualRatios.fat],
                        backgroundColor: ['#3498db', '#2ecc71', '#f39c12'],
                        borderWidth: 1
                    },
                    {
                        label: 'Mục tiêu',
                        data: [goals.ratios.carbs, goals.ratios.protein, goals.ratios.fat],
                        backgroundColor: ['#2980b9', '#27ae60', '#e67e22'],
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.parsed.toFixed(1)}%`;
                            }
                        }
                    }
                }
            }
        });

        // Biểu đồ 2: So sánh với mục tiêu
        const goalComparisonCtx = document.getElementById('goalComparisonChart').getContext('2d');
        new Chart(goalComparisonCtx, {
            type: 'bar',
            data: {
                labels: ['Năng lượng (kcal)', 'Carbohydrate (g)', 'Protein (g)', 'Chất béo (g)', 'Chất xơ (g)'],
                datasets: [
                    {
                        label: 'Thực tế',
                        data: [averages.energy, averages.carbs, averages.protein, averages.fat, averages.fiber],
                        backgroundColor: '#3498db'
                    },
                    {
                        label: 'Mục tiêu',
                        data: [goals.energy, goals.carbs, goals.protein, goals.fat, goals.fiber],
                        backgroundColor: '#2ecc71'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Biểu đồ 3: Biến động năng lượng hàng ngày
        const dailyEnergyCtx = document.getElementById('dailyEnergyChart').getContext('2d');
        new Chart(dailyEnergyCtx, {
            type: 'line',
            data: {
                labels: nutritionData.map(day => day.date),
                datasets: [
                    {
                        label: 'Năng lượng (kcal)',
                        data: nutritionData.map(day => day.energy),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Mục tiêu',
                        data: Array(nutritionData.length).fill(goals.energy),
                        borderColor: '#2ecc71',
                        borderDash: [5, 5],
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        ticks: {
                            maxTicksLimit: 10
                        }
                    },
                    y: {
                        min: 1600,
                        max: 2100
                    }
                }
            }
        });

        // Biểu đồ 4: Vitamin
        const vitaminCtx = document.getElementById('vitaminChart').getContext('2d');
        new Chart(vitaminCtx, {
            type: 'bar',
            data: {
                labels: ['Vitamin A (µg)', 'Vitamin C (mg)', 'Vitamin D (IU)', 'Vitamin E (mg)'],
                datasets: [
                    {
                        label: 'Thực tế',
                        data: [averages.vitA, averages.vitC, averages.vitD, averages.vitE],
                        backgroundColor: '#3498db'
                    },
                    {
                        label: 'Khuyến nghị',
                        data: [900, 90, 600, 15],
                        backgroundColor: '#2ecc71'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Biểu đồ 5: Khoáng chất
        const mineralCtx = document.getElementById('mineralChart').getContext('2d');
        new Chart(mineralCtx, {
            type: 'bar',
            data: {
                labels: ['Calcium (mg)', 'Sắt (mg)', 'Magie (mg)', 'Kẽm (mg)'],
                datasets: [
                    {
                        label: 'Thực tế',
                        data: [averages.calcium, averages.iron, averages.magnesium, averages.zinc],
                        backgroundColor: '#3498db'
                    },
                    {
                        label: 'Khuyến nghị',
                        data: [1000, 8, 400, 11],
                        backgroundColor: '#2ecc71'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Biểu đồ 6: Xu hướng theo tuần
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        
        // Tính trung bình theo tuần
        const weeklyAverages = [];
        for (let i = 0; i < nutritionData.length; i += 7) {
            const weekData = nutritionData.slice(i, i + 7);
            weeklyAverages.push({
                energy: weekData.reduce((sum, day) => sum + day.energy, 0) / weekData.length,
                carbs: weekData.reduce((sum, day) => sum + day.carbs, 0) / weekData.length,
                protein: weekData.reduce((sum, day) => sum + day.protein, 0) / weekData.length,
                fat: weekData.reduce((sum, day) => sum + day.fat, 0) / weekData.length
            });
        }
        
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: ['Tuần 1', 'Tuần 2', 'Tuần 3', 'Tuần 4', 'Tuần 5'],
                datasets: [
                    {
                        label: 'Năng lượng (kcal)',
                        data: weeklyAverages.map(week => week.energy),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        yAxisID: 'y',
                        fill: true
                    },
                    {
                        label: 'Carbohydrate (g)',
                        data: weeklyAverages.map(week => week.carbs),
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        yAxisID: 'y1',
                        fill: true
                    },
                    {
                        label: 'Protein (g)',
                        data: weeklyAverages.map(week => week.protein),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        yAxisID: 'y1',
                        fill: true
                    },
                    {
                        label: 'Chất béo (g)',
                        data: weeklyAverages.map(week => week.fat),
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        yAxisID: 'y1',
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Năng lượng (kcal)'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Chất dinh dưỡng (g)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // Biểu đồ 7: Tương quan giữa chất béo và carbohydrate
        const correlationCtx = document.getElementById('correlationChart').getContext('2d');
        new Chart(correlationCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Ngày',
                    data: nutritionData.map(day => ({
                        x: day.fat,
                        y: day.carbs
                    })),
                    backgroundColor: '#3498db'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Chất béo (g)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Carbohydrate (g)'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const day = nutritionData.find(d => 
                                    d.fat === context.parsed.x && d.carbs === context.parsed.y
                                );
                                return `Ngày: ${day.date}, Chất béo: ${context.parsed.x}g, Carb: ${context.parsed.y}g`;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>