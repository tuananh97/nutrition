<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o C√°o Ph√¢n T√≠ch Dinh D∆∞·ª°ng</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }

        .patient-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .patient-info h3 {
            color: #2980b9;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .info-item strong {
            color: #2c3e50;
        }

        .targets {
            background: rgba(46, 204, 113, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #2ecc71;
        }

        .targets h4 {
            color: #27ae60;
            margin-bottom: 10px;
        }

        .targets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .target-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-5px);
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3rem;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .summary-card h3 {
            color: #2980b9;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-top: 3px solid #3498db;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .recommendations {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .recommendations h3 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .recommendations ul {
            list-style: none;
            padding-left: 0;
        }

        .recommendations li {
            background: rgba(255, 255, 255, 0.2);
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        .recommendations li::before {
            content: "üí° ";
            margin-right: 8px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border-left: 4px solid #007bff;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• B√°o C√°o Ph√¢n T√≠ch Dinh D∆∞·ª°ng</h1>
            <p class="subtitle">Theo d√µi ch·∫ø ƒë·ªô dinh d∆∞·ª°ng qua PEG - Th√°ng 7/2025</p>
        </div>

        <div class="patient-info">
            <h3>üìã Th√¥ng Tin B·ªánh Nh√¢n</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Gi·ªõi t√≠nh:</strong> Nam
                </div>
                <div class="info-item">
                    <strong>Tu·ªïi:</strong> 28 tu·ªïi
                </div>
                <div class="info-item">
                    <strong>ƒê∆∞·ªùng dinh d∆∞·ª°ng:</strong> PEG + ƒê∆∞·ªùng u·ªëng
                </div>
                <div class="info-item">
                    <strong>S·ªë b·ªØa/ng√†y:</strong> 6 b·ªØa
                </div>
            </div>
            
            <div class="targets">
                <h4>üéØ M·ª•c Ti√™u Dinh D∆∞·ª°ng</h4>
                <div class="targets-grid">
                    <div class="target-item">
                        <strong>1700</strong><br>kcal/ng√†y
                    </div>
                    <div class="target-item">
                        <strong>75g</strong><br>Protein
                    </div>
                    <div class="target-item">
                        <strong>65g</strong><br>Ch·∫•t b√©o
                    </div>
                    <div class="target-item">
                        <strong>190g</strong><br>Carbohydrate
                    </div>
                    <div class="target-item">
                        <strong>25g</strong><br>Ch·∫•t x∆°
                    </div>
                </div>
            </div>
        </div>

        <div class="summary-grid">
            <div class="summary-card">
                <h3>üìä T·ªïng Quan Th·ªëng K√™</h3>
                <div class="stats-container">
                    <div class="stat-item">
                        <span class="stat-value" id="avgCalories">0</span>
                        <div class="stat-label">Calo TB/ng√†y</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgProtein">0</span>
                        <div class="stat-label">Protein TB (g)</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgFat">0</span>
                        <div class="stat-label">Ch·∫•t b√©o TB (g)</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgCarbs">0</span>
                        <div class="stat-label">Carbs TB (g)</div>
                    </div>
                </div>
                <div id="nutritionAlerts"></div>
            </div>

            <div class="summary-card">
                <h3>‚öñÔ∏è So S√°nh V·ªõi M·ª•c Ti√™u</h3>
                <div class="chart-wrapper" style="height: 250px;">
                    <canvas id="targetComparisonChart"></canvas>
                </div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <h3>üìà Bi·∫øn ƒê·ªông Calo Theo Th·ªùi Gian</h3>
                <div class="chart-wrapper">
                    <canvas id="caloriesTrendChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>ü•ó T·ª∑ L·ªá Dinh D∆∞·ª°ng Trung B√¨nh</h3>
                <div class="chart-wrapper">
                    <canvas id="macroDistributionChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìä Ph√¢n T√≠ch Protein Theo Ng√†y</h3>
                <div class="chart-wrapper">
                    <canvas id="proteinAnalysisChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üîÑ Ma Tr·∫≠n T∆∞∆°ng Quan Dinh D∆∞·ª°ng</h3>
                <div class="chart-wrapper">
                    <canvas id="correlationChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìÖ Ph√¢n T√≠ch Theo Tu·∫ßn</h3>
                <div class="chart-wrapper">
                    <canvas id="weeklyAnalysisChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>‚ö° ƒê·ªô Bi·∫øn ƒê·ªông Dinh D∆∞·ª°ng</h3>
                <div class="chart-wrapper">
                    <canvas id="variabilityChart"></canvas>
                </div>
            </div>
        </div>

        <div class="recommendations">
            <h3>üí° Khuy·∫øn Ngh·ªã C·∫£i Thi·ªán Ch·∫ø ƒê·ªô Dinh D∆∞·ª°ng</h3>
            <ul id="recommendationsList"></ul>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu dinh d∆∞·ª°ng
        const nutritionData = [
            { date: '01/07/2025', fat: 451, carbs: 829, protein: 264 },
            { date: '02/07/2025', fat: 547, carbs: 808, protein: 293 },
            { date: '03/07/2025', fat: 536, carbs: 759, protein: 287 },
            { date: '04/07/2025', fat: 681, carbs: 774, protein: 297 },
            { date: '05/07/2025', fat: 566, carbs: 834, protein: 283 },
            { date: '06/07/2025', fat: 591, carbs: 748, protein: 269 },
            { date: '07/07/2025', fat: 741, carbs: 762, protein: 313 },
            { date: '08/07/2025', fat: 733, carbs: 812, protein: 285 },
            { date: '09/07/2025', fat: 589, carbs: 892, protein: 287 },
            { date: '10/07/2025', fat: 635, carbs: 771, protein: 270 },
            { date: '11/07/2025', fat: 613, carbs: 833, protein: 277 },
            { date: '12/07/2025', fat: 691, carbs: 916, protein: 278 },
            { date: '13/07/2025', fat: 647, carbs: 857, protein: 272 },
            { date: '14/07/2025', fat: 575, carbs: 936, protein: 293 },
            { date: '15/07/2025', fat: 617, carbs: 850, protein: 314 },
            { date: '16/07/2025', fat: 616, carbs: 898, protein: 303 },
            { date: '17/07/2025', fat: 577, carbs: 805, protein: 285 },
            { date: '18/07/2025', fat: 501, carbs: 735, protein: 269 },
            { date: '19/07/2025', fat: 640, carbs: 894, protein: 262 },
            { date: '20/07/2025', fat: 573, carbs: 763, protein: 311 },
            { date: '21/07/2025', fat: 612, carbs: 879, protein: 251 },
            { date: '22/07/2025', fat: 774, carbs: 760, protein: 371 },
            { date: '23/07/2025', fat: 620, carbs: 929, protein: 292 },
            { date: '24/07/2025', fat: 587, carbs: 884, protein: 358 },
            { date: '25/07/2025', fat: 651, carbs: 744, protein: 258 },
            { date: '26/07/2025', fat: 634, carbs: 775, protein: 337 },
            { date: '27/07/2025', fat: 610, carbs: 793, protein: 246 },
            { date: '28/07/2025', fat: 562, carbs: 785, protein: 263 },
            { date: '29/07/2025', fat: 704, carbs: 722, protein: 295 },
            { date: '30/07/2025', fat: 710, carbs: 714, protein: 281 },
            { date: '31/07/2025', fat: 695, carbs: 799, protein: 341 }
        ];

        // M·ª•c ti√™u dinh d∆∞·ª°ng
        const targets = {
            calories: 1700,
            protein: 75, // gram
            fat: 65, // gram  
            carbs: 190, // gram
            fiber: 25, // gram
            proteinRatio: 20, // %
            fatRatio: 35, // %
            carbsRatio: 45 // %
        };

        // T√≠nh to√°n th·ªëng k√™
        function calculateStats() {
            const totalDays = nutritionData.length;
            
            const totals = nutritionData.reduce((acc, day) => {
                const totalCalories = day.fat + day.carbs + day.protein;
                acc.calories += totalCalories;
                acc.fat += day.fat / 9; // chuy·ªÉn t·ª´ kcal sang gram
                acc.carbs += day.carbs / 4; // chuy·ªÉn t·ª´ kcal sang gram  
                acc.protein += day.protein / 4; // chuy·ªÉn t·ª´ kcal sang gram
                return acc;
            }, { calories: 0, fat: 0, carbs: 0, protein: 0 });

            return {
                avgCalories: Math.round(totals.calories / totalDays),
                avgFat: Math.round(totals.fat / totalDays),
                avgCarbs: Math.round(totals.carbs / totalDays),
                avgProtein: Math.round(totals.protein / totalDays)
            };
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const stats = calculateStats();
            
            document.getElementById('avgCalories').textContent = stats.avgCalories;
            document.getElementById('avgProtein').textContent = stats.avgProtein;
            document.getElementById('avgFat').textContent = stats.avgFat;
            document.getElementById('avgCarbs').textContent = stats.avgCarbs;

            // T·∫°o c·∫£nh b√°o
            const alertsContainer = document.getElementById('nutritionAlerts');
            alertsContainer.innerHTML = '';

            if (stats.avgCalories < targets.calories * 0.9) {
                alertsContainer.innerHTML += '<div class="alert alert-warning">‚ö†Ô∏è Calo th·∫•p h∆°n m·ª•c ti√™u 10%</div>';
            } else if (stats.avgCalories > targets.calories * 1.1) {
                alertsContainer.innerHTML += '<div class="alert alert-warning">‚ö†Ô∏è Calo cao h∆°n m·ª•c ti√™u 10%</div>';
            } else {
                alertsContainer.innerHTML += '<div class="alert alert-success">‚úÖ Calo ƒë·∫°t m·ª•c ti√™u</div>';
            }

            if (stats.avgProtein < targets.protein * 0.9) {
                alertsContainer.innerHTML += '<div class="alert alert-warning">‚ö†Ô∏è Protein th·∫•p h∆°n m·ª•c ti√™u</div>';
            } else {
                alertsContainer.innerHTML += '<div class="alert alert-success">‚úÖ Protein ƒë·∫°t y√™u c·∫ßu</div>';
            }
        }

        // Bi·ªÉu ƒë·ªì xu h∆∞·ªõng calo
        function createCaloriesTrendChart() {
            const ctx = document.getElementById('caloriesTrendChart').getContext('2d');
            
            const dailyCalories = nutritionData.map(day => day.fat + day.carbs + day.protein);
            const dates = nutritionData.map(day => day.date.split('/')[0]);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Calo th·ª±c t·∫ø',
                        data: dailyCalories,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'M·ª•c ti√™u calo',
                        data: Array(31).fill(targets.calories),
                        borderColor: '#e74c3c',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 1200,
                            max: 2000
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì ph√¢n b·ªë dinh d∆∞·ª°ng
        function createMacroDistributionChart() {
            const ctx = document.getElementById('macroDistributionChart').getContext('2d');
            
            const stats = calculateStats();
            const totalCalories = stats.avgCalories;
            
            const actualRatios = {
                protein: (stats.avgProtein * 4 / totalCalories * 100).toFixed(1),
                fat: (stats.avgFat * 9 / totalCalories * 100).toFixed(1),
                carbs: (stats.avgCarbs * 4 / totalCalories * 100).toFixed(1)
            };

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [`Protein (${actualRatios.protein}%)`, `Ch·∫•t b√©o (${actualRatios.fat}%)`, `Carbs (${actualRatios.carbs}%)`],
                    datasets: [{
                        data: [actualRatios.protein, actualRatios.fat, actualRatios.carbs],
                        backgroundColor: ['#2ecc71', '#f39c12', '#9b59b6'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì so s√°nh v·ªõi m·ª•c ti√™u
        function createTargetComparisonChart() {
            const ctx = document.getElementById('targetComparisonChart').getContext('2d');
            const stats = calculateStats();

            const comparisonData = {
                calories: (stats.avgCalories / targets.calories * 100).toFixed(1),
                protein: (stats.avgProtein / targets.protein * 100).toFixed(1),
                fat: (stats.avgFat / targets.fat * 100).toFixed(1),
                carbs: (stats.avgCarbs / targets.carbs * 100).toFixed(1)
            };

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Calo', 'Protein', 'Ch·∫•t b√©o', 'Carbs'],
                    datasets: [{
                        label: '% so v·ªõi m·ª•c ti√™u',
                        data: [comparisonData.calories, comparisonData.protein, comparisonData.fat, comparisonData.carbs],
                        backgroundColor: ['#3498db', '#2ecc71', '#f39c12', '#9b59b6'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }, {
                        label: 'M·ª•c ti√™u 100%',
                        data: [100, 100, 100, 100],
                        backgroundColor: 'rgba(231, 76, 60, 0.3)',
                        borderColor: '#e74c3c',
                        borderWidth: 2,
                        type: 'line'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 150,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì ph√¢n t√≠ch protein
        function createProteinAnalysisChart() {
            const ctx = document.getElementById('proteinAnalysisChart').getContext('2d');
            
            const proteinData = nutritionData.map(day => day.protein / 4); // chuy·ªÉn sang gram
            const dates = nutritionData.map(day => day.date.split('/')[0]);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Protein (g)',
                        data: proteinData,
                        backgroundColor: proteinData.map(value => 
                            value >= targets.protein ? '#2ecc71' : value >= targets.protein * 0.8 ? '#f39c12' : '#e74c3c'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì t∆∞∆°ng quan
        function createCorrelationChart() {
            const ctx = document.getElementById('correlationChart').getContext('2d');

            const proteinData = nutritionData.map(day => day.protein / 4);
            const fatData = nutritionData.map(day => day.fat / 9);
            
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Protein vs Ch·∫•t b√©o',
                        data: proteinData.map((protein, index) => ({
                            x: protein,
                            y: fatData[index]
                        })),
                        backgroundColor: '#3498db',
                        borderColor: '#2980b9',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Protein (g)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Ch·∫•t b√©o (g)'
                            }
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì ph√¢n t√≠ch theo tu·∫ßn
        function createWeeklyAnalysisChart() {
            const ctx = document.getElementById('weeklyAnalysisChart').getContext('2d');

            // Chia d·ªØ li·ªáu theo tu·∫ßn
            const weeks = [];
            for (let i = 0; i < nutritionData.length; i += 7) {
                const weekData = nutritionData.slice(i, i + 7);
                const weekAvg = {
                    week: `Tu·∫ßn ${Math.floor(i/7) + 1}`,
                    calories: weekData.reduce((sum, day) => sum + day.fat + day.carbs + day.protein, 0) / weekData.length,
                    protein: weekData.reduce((sum, day) => sum + day.protein / 4, 0) / weekData.length,
                    fat: weekData.reduce((sum, day) => sum + day.fat / 9, 0) / weekData.length,
                    carbs: weekData.reduce((sum, day) => sum + day.carbs / 4, 0) / weekData.length
                };
                weeks.push(weekAvg);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks.map(w => w.week),
                    datasets: [{
                        label: 'Calo TB',
                        data: weeks.map(w => w.calories),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        yAxisID: 'y'
                    }, {
                        label: 'Protein TB (g)',
                        data: weeks.map(w => w.protein),
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Bi·ªÉu ƒë·ªì ƒë·ªô bi·∫øn ƒë·ªông
        function createVariabilityChart() {
            const ctx = document.getElementById('variabilityChart').getContext('2d');

            // T√≠nh ƒë·ªô l·ªách chu·∫©n cho t·ª´ng nh√≥m dinh d∆∞·ª°ng
            const proteinData = nutritionData.map(day => day.protein / 4);
            const fatData = nutritionData.map(day => day.fat / 9);
            const carbsData = nutritionData.map(day => day.carbs / 4);
            const caloriesData = nutritionData.map(day => day.fat + day.carbs + day.protein);

            function calculateCV(data) {
                const mean = data.reduce((sum, val) => sum + val, 0) / data.length;
                const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
                const std = Math.sqrt(variance);
                return (std / mean * 100).toFixed(1); // Coefficient of Variation
            }

            const variabilityData = {
                protein: calculateCV(proteinData),
                fat: calculateCV(fatData),
                carbs: calculateCV(carbsData),
                calories: calculateCV(caloriesData)
            };

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Protein', 'Ch·∫•t b√©o', 'Carbohydrate', 'T·ªïng Calo'],
                    datasets: [{
                        label: 'ƒê·ªô bi·∫øn ƒë·ªông (%)',
                        data: [variabilityData.protein, variabilityData.fat, variabilityData.carbs, variabilityData.calories],
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 30,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // T·∫°o khuy·∫øn ngh·ªã
        function generateRecommendations() {
            const stats = calculateStats();
            const recommendations = [];
            
            const calorieDeviation = (stats.avgCalories - targets.calories) / targets.calories * 100;
            const proteinDeviation = (stats.avgProtein - targets.protein) / targets.protein * 100;
            const fatDeviation = (stats.avgFat - targets.fat) / targets.fat * 100;
            const carbsDeviation = (stats.avgCarbs - targets.carbs) / targets.carbs * 100;

            // Ph√¢n t√≠ch calo
            if (Math.abs(calorieDeviation) > 10) {
                if (calorieDeviation > 10) {
                    recommendations.push(`Calo trung b√¨nh cao h∆°n m·ª•c ti√™u ${Math.abs(calorieDeviation).toFixed(1)}%. C·∫ßn gi·∫£m kh·∫©u ph·∫ßn ho·∫∑c ƒëi·ªÅu ch·ªânh th√†nh ph·∫ßn th·ª©c ƒÉn ƒë·ªÉ tr√°nh tƒÉng c√¢n kh√¥ng mong mu·ªën.`);
                } else {
                    recommendations.push(`Calo trung b√¨nh th·∫•p h∆°n m·ª•c ti√™u ${Math.abs(calorieDeviation).toFixed(1)}%. C·∫ßn tƒÉng c∆∞·ªùng dinh d∆∞·ª°ng ƒë·ªÉ ƒë·∫£m b·∫£o nhu c·∫ßu nƒÉng l∆∞·ª£ng c∆° b·∫£n c·ªßa c∆° th·ªÉ.`);
                }
            } else {
                recommendations.push('L∆∞·ª£ng calo h√†ng ng√†y ƒë·∫°t m·ª•c ti√™u t·ªët. Duy tr√¨ ch·∫ø ƒë·ªô dinh d∆∞·ª°ng hi·ªán t·∫°i.');
            }

            // Ph√¢n t√≠ch protein
            if (proteinDeviation < -10) {
                recommendations.push(`Protein th·∫•p h∆°n m·ª•c ti√™u ${Math.abs(proteinDeviation).toFixed(1)}%. C·∫ßn b·ªï sung th√™m protein t·ª´ s·ªØa, tr·ª©ng ho·∫∑c th·ªãt xay ƒë·ªÉ h·ªó tr·ª£ qu√° tr√¨nh ph·ª•c h·ªìi v√† duy tr√¨ kh·ªëi l∆∞·ª£ng c∆°.`);
            } else if (proteinDeviation > 20) {
                recommendations.push(`Protein cao h∆°n m·ª•c ti√™u ${proteinDeviation.toFixed(1)}%. C√≥ th·ªÉ gi·∫£m b·ªõt ƒë·ªÉ c√¢n b·∫±ng v·ªõi c√°c nh√≥m dinh d∆∞·ª°ng kh√°c.`);
            }

            // Ph√¢n t√≠ch ch·∫•t b√©o
            if (fatDeviation > 15) {
                recommendations.push(`Ch·∫•t b√©o cao h∆°n m·ª•c ti√™u ${fatDeviation.toFixed(1)}%. N√™n gi·∫£m l∆∞·ª£ng d·∫ßu ƒÉn trong s√∫p xay v√† ch·ªçn c√°c lo·∫°i s·ªØa √≠t b√©o h∆°n.`);
            } else if (fatDeviation < -15) {
                recommendations.push('Ch·∫•t b√©o th·∫•p h∆°n m·ª•c ti√™u. C·∫ßn b·ªï sung ch·∫•t b√©o thi·∫øt y·∫øu t·ª´ d·∫ßu th·ª±c v·∫≠t ho·∫∑c c√°c lo·∫°i h·∫°t.');
            }

            // Ph√¢n t√≠ch carbohydrate
            if (carbsDeviation > 15) {
                recommendations.push(`Carbohydrate cao h∆°n m·ª•c ti√™u ${carbsDeviation.toFixed(1)}%. N√™n gi·∫£m l∆∞·ª£ng ƒë∆∞·ªùng trong n∆∞·ªõc tr√°i c√¢y v√† sinh t·ªë.`);
            } else if (carbsDeviation < -15) {
                recommendations.push('Carbohydrate th·∫•p h∆°n m·ª•c ti√™u. C·∫ßn b·ªï sung th√™m tinh b·ªôt t·ª´ ch√°o, khoai ho·∫∑c b√°nh m√¨.');
            }

            // Ph√¢n t√≠ch ƒë·ªô bi·∫øn ƒë·ªông
            const proteinData = nutritionData.map(day => day.protein / 4);
            const proteinStd = Math.sqrt(proteinData.reduce((sum, val) => {
                const mean = stats.avgProtein;
                return sum + Math.pow(val - mean, 2);
            }, 0) / proteinData.length);
            
            if (proteinStd > stats.avgProtein * 0.2) {
                recommendations.push('L∆∞·ª£ng protein c√≥ ƒë·ªô bi·∫øn ƒë·ªông cao gi·ªØa c√°c ng√†y. N√™n thi·∫øt l·∫≠p th·ª±c ƒë∆°n c·ªë ƒë·ªãnh ƒë·ªÉ ƒë·∫£m b·∫£o s·ª± ·ªïn ƒë·ªãnh.');
            }

            // Khuy·∫øn ngh·ªã chung
            recommendations.push('Ti·∫øp t·ª•c theo d√µi ch·∫∑t ch·∫Ω t√¨nh tr·∫°ng dinh d∆∞·ª°ng v√† ƒëi·ªÅu ch·ªânh k·ªãp th·ªùi d·ª±a tr√™n ph·∫£n h·ªìi c·ªßa c∆° th·ªÉ.');
            recommendations.push('ƒê·∫£m b·∫£o v·ªá sinh an to√†n th·ª±c ph·∫©m khi chu·∫©n b·ªã c√°c b·ªØa ƒÉn qua PEG.');
            recommendations.push('Tham kh·∫£o √Ω ki·∫øn b√°c sƒ© dinh d∆∞·ª°ng ƒë·ªÉ ƒëi·ªÅu ch·ªânh ch·∫ø ƒë·ªô ƒÉn ph√π h·ª£p v·ªõi t√¨nh tr·∫°ng s·ª©c kh·ªèe hi·ªán t·∫°i.');

            return recommendations;
        }

        // Hi·ªÉn th·ªã khuy·∫øn ngh·ªã
        function displayRecommendations() {
            const recommendations = generateRecommendations();
            const recommendationsList = document.getElementById('recommendationsList');
            
            recommendationsList.innerHTML = recommendations
                .map(rec => `<li>${rec}</li>`)
                .join('');
        }

        // Kh·ªüi t·∫°o t·∫•t c·∫£ bi·ªÉu ƒë·ªì v√† th·ªëng k√™
        function initializeDashboard() {
            updateStats();
            createCaloriesTrendChart();
            createMacroDistributionChart();
            createTargetComparisonChart();
            createProteinAnalysisChart();
            createCorrelationChart();
            createWeeklyAnalysisChart();
            createVariabilityChart();
            displayRecommendations();
        }

        // Kh·ªüi t·∫°o dashboard khi trang ƒë∆∞·ª£c load
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>